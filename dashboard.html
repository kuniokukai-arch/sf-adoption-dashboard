<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Salesforce å°å…¥åˆ†æãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<style>
  :root {
    --bg: #0f1117;
    --card: #1a1d27;
    --card2: #222638;
    --border: #2e3350;
    --accent: #00a1e0;
    --accent2: #ff6b35;
    --green: #2ecc71;
    --yellow: #f1c40f;
    --text: #e8eaf0;
    --muted: #8892b0;
    --sf-blue: #0176d3;
    --cmp-a: #00a1e0;
    --cmp-b: #ff6b35;
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { background: var(--bg); color: var(--text); font-family: 'Segoe UI', 'Hiragino Sans', sans-serif; min-height: 100vh; }

  /* ===== HEADER ===== */
  .header {
    background: linear-gradient(135deg, #0a0e1a 0%, #0d1a3a 50%, #0a1528 100%);
    border-bottom: 1px solid var(--border);
    padding: 18px 32px;
    display: flex; align-items: center; justify-content: space-between;
    position: sticky; top: 0; z-index: 100;
  }
  .header-left { display: flex; align-items: center; gap: 16px; }
  .logo { width: 34px; height: 34px; background: var(--sf-blue); border-radius: 8px;
    display: flex; align-items: center; justify-content: center; font-size: 16px; font-weight: 900; color: white; flex-shrink:0; }
  .header h1 { font-size: 18px; font-weight: 700; }
  .header-sub { font-size: 11px; color: var(--muted); margin-top: 2px; }
  .header-right { display:flex; align-items:center; gap:12px; }
  .badge { background: var(--sf-blue); color: white; font-size: 11px; padding: 4px 12px; border-radius: 20px; font-weight: 600; white-space:nowrap; }

  /* compare mode toggle */
  .cmp-toggle-btn {
    display:flex; align-items:center; gap:6px; padding:5px 14px; border-radius:8px;
    font-size:12px; font-weight:700; cursor:pointer; border:1px solid var(--border);
    color:var(--muted); background:transparent; transition:all 0.2s;
    white-space:nowrap;
  }
  .cmp-toggle-btn:hover { border-color:var(--cmp-a); color:var(--cmp-a); }
  .cmp-toggle-btn.active { border-color:var(--cmp-a); color:white; background:linear-gradient(90deg,rgba(0,161,224,0.25),rgba(255,107,53,0.25)); }
  .cmp-dot { width:7px;height:7px;border-radius:50%;display:inline-block; }

  /* ===== GLOBAL FILTER BAR ===== */
  .filter-bar-wrap { position:sticky; top:71px; z-index:99; }

  /* normal filter bar */
  .filter-bar {
    background: #13162280;
    border-bottom: 1px solid var(--border);
    padding: 10px 32px;
    display: flex; align-items: center; gap: 20px; flex-wrap: wrap;
    backdrop-filter: blur(6px);
  }
  /* compare filter bar */
  .cmp-filter-bar {
    background:#13162299;
    border-bottom:1px solid var(--border);
    padding:8px 32px;
    display:none; gap:0; flex-wrap:wrap;
    backdrop-filter:blur(6px);
  }
  .cmp-filter-bar.visible { display:flex; flex-direction:column; gap:0; }
  .cmp-row {
    display:flex; align-items:center; gap:16px; flex-wrap:wrap;
    padding:7px 0;
  }
  .cmp-row:first-child { border-bottom:1px solid rgba(255,255,255,0.05); }
  .cmp-label {
    font-size:11px; font-weight:800; letter-spacing:0.5px; padding:3px 10px;
    border-radius:12px; white-space:nowrap; flex-shrink:0;
  }
  .cmp-label.a { background:rgba(0,161,224,0.2); color:var(--cmp-a); border:1px solid rgba(0,161,224,0.4); }
  .cmp-label.b { background:rgba(255,107,53,0.2); color:var(--cmp-b); border:1px solid rgba(255,107,53,0.4); }

  .filter-group { display: flex; align-items: center; gap: 8px; }
  .filter-label { font-size: 11px; color: var(--muted); font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; white-space: nowrap; }
  .filter-select {
    background: var(--card2); border: 1px solid var(--border); color: var(--text);
    padding: 5px 28px 5px 10px; border-radius: 8px; font-size: 12px; cursor: pointer;
    appearance: none; -webkit-appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6'%3E%3Cpath d='M0 0l5 6 5-6z' fill='%238892b0'/%3E%3C/svg%3E");
    background-repeat: no-repeat; background-position: right 8px center;
    min-width: 130px;
  }
  .filter-select:focus { outline: none; border-color: var(--accent); }
  .chip-row { display: flex; gap: 5px; flex-wrap: wrap; }
  .chip {
    padding: 4px 10px; border-radius: 16px; font-size: 11px; font-weight: 600;
    cursor: pointer; border: 1px solid var(--border); color: var(--muted); background: transparent;
    transition: all 0.15s; white-space: nowrap;
  }
  .chip:hover { border-color: var(--accent); color: var(--accent); }
  .chip.active { color: white; border-color: transparent; }
  .filter-reset {
    margin-left: auto; padding: 5px 14px; border-radius: 8px; font-size: 11px; font-weight: 700;
    cursor: pointer; border: 1px solid var(--border); color: var(--muted); background: transparent;
    transition: all 0.15s; white-space: nowrap;
  }
  .filter-reset:hover { border-color: var(--accent2); color: var(--accent2); }

  /* ===== LAYOUT ===== */
  .main { padding: 24px 32px; max-width: 1600px; margin: 0 auto; }
  .kpi-row { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 22px; }
  .kpi-card {
    background: var(--card); border: 1px solid var(--border); border-radius: 14px;
    padding: 18px 22px; position: relative; overflow: hidden;
  }
  .kpi-card::before { content:''; position:absolute; top:0; left:0; right:0; height:3px; background:var(--accent-color,var(--accent)); }
  .kpi-label { font-size: 11px; color: var(--muted); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; }
  .kpi-value { font-size: 32px; font-weight: 800; line-height: 1; }
  .kpi-sub { font-size: 11px; color: var(--muted); margin-top: 6px; }
  .kpi-icon { position: absolute; top: 14px; right: 18px; font-size: 26px; opacity: 0.18; }

  /* compare KPI */
  .kpi-cmp { display:flex; flex-direction:column; gap:6px; }
  .kpi-cmp-row { display:flex; align-items:center; justify-content:space-between; gap:8px; }
  .kpi-cmp-val { font-size:22px; font-weight:800; }
  .kpi-cmp-tag { font-size:10px; font-weight:700; padding:2px 7px; border-radius:10px; flex-shrink:0; }
  .kpi-cmp-tag.a { background:rgba(0,161,224,0.2); color:var(--cmp-a); }
  .kpi-cmp-tag.b { background:rgba(255,107,53,0.2); color:var(--cmp-b); }
  .kpi-cmp-diff { font-size:11px; color:var(--muted); margin-top:4px; border-top:1px solid rgba(255,255,255,0.05); padding-top:6px; }

  .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
  .grid-3 { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; margin-bottom: 20px; }
  .full { margin-bottom: 20px; }

  .card { background: var(--card); border: 1px solid var(--border); border-radius: 14px; padding: 20px; }
  .card-title {
    font-size: 12px; font-weight: 700; color: var(--muted); text-transform: uppercase;
    letter-spacing: 0.5px; margin-bottom: 16px; display: flex; align-items: center; gap: 8px; flex-wrap:wrap;
  }
  .dot { width: 7px; height: 7px; border-radius: 50%; display: inline-block; flex-shrink:0; }
  .chart-wrap { position: relative; }
  .h340 { height: 340px; }
  .h280 { height: 280px; }
  .h240 { height: 240px; }

  /* ===== PRODUCT CARDS ===== */
  .product-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 16px; }
  .product-card {
    background: var(--card2); border: 1px solid var(--border); border-radius: 10px;
    padding: 12px 14px; position: relative; overflow: hidden;
  }
  .product-card::before { content:''; position:absolute; left:0; top:0; bottom:0; width:3px; background:var(--p-color); }
  .product-name { font-size: 11px; font-weight: 700; margin-bottom: 4px; }
  .product-count { font-size: 20px; font-weight: 800; }
  .product-share { font-size: 10px; color: var(--muted); margin-top: 3px; }
  /* compare product card */
  .product-card-cmp { font-size:10px; color:var(--muted); margin-top:4px; border-top:1px solid rgba(255,255,255,0.05); padding-top:4px; }
  .product-cmp-a { color:var(--cmp-a); font-weight:700; }
  .product-cmp-b { color:var(--cmp-b); font-weight:700; }

  /* ===== TABLE ===== */
  .pref-table { width: 100%; border-collapse: collapse; font-size: 12px; }
  .pref-table th { text-align: left; padding: 7px 10px; color: var(--muted); font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; border-bottom: 1px solid var(--border); cursor: pointer; user-select: none; }
  .pref-table th:hover { color: var(--accent); }
  .pref-table td { padding: 8px 10px; border-bottom: 1px solid rgba(255,255,255,0.04); vertical-align:middle; }
  .pref-table tr:hover td { background: rgba(255,255,255,0.025); }
  .rank { color: var(--muted); font-size: 10px; font-weight: 700; }
  .pref-name { font-weight: 600; }
  .rate-bar-wrap { display: flex; align-items: center; gap: 6px; }
  .rate-bar { height: 5px; border-radius: 3px; background: var(--accent); min-width: 2px; transition: width 0.3s; }
  .rate-val { font-size: 11px; font-weight: 700; min-width: 38px; }
  .ws-badge { background: rgba(255,107,53,0.15); color: var(--accent2); border-radius: 4px; padding: 1px 6px; font-size: 10px; font-weight: 600; }
  .scroll-y { overflow-y: auto; max-height: 380px; }
  .scroll-y::-webkit-scrollbar { width: 3px; }
  .scroll-y::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }

  /* ===== FILTER ACTIVE INDICATOR ===== */
  .active-filter-hint { font-size: 11px; color: var(--accent); margin-left: 6px; font-weight: 600; }

  /* ===== COMPANY LIST ===== */
  .company-section { margin-bottom: 30px; }
  .company-toolbar {
    display:flex; align-items:center; gap:12px; flex-wrap:wrap; margin-bottom:8px;
  }
  .company-filter-row {
    display:flex; align-items:center; gap:14px; flex-wrap:wrap;
    margin-bottom:10px; padding:10px 14px;
    background:var(--card2); border:1px solid var(--border); border-radius:10px;
  }
  .company-filter-group { display:flex; align-items:center; gap:7px; flex-wrap:wrap; }
  .company-filter-label {
    font-size:10px; font-weight:700; color:var(--muted); text-transform:uppercase;
    letter-spacing:0.5px; white-space:nowrap;
  }
  .company-search {
    flex:1; min-width:180px; max-width:280px;
    background:var(--card2); border:1px solid var(--border); color:var(--text);
    padding:7px 14px; border-radius:8px; font-size:13px;
  }
  .company-search:focus { outline:none; border-color:var(--accent); }
  .company-search::placeholder { color:var(--muted); }
  .seg-btn {
    padding:4px 11px; border-radius:20px; font-size:11px; font-weight:700;
    cursor:pointer; border:1px solid var(--border); color:var(--muted); background:transparent; transition:all 0.15s;
  }
  .seg-btn.active { background:var(--sf-blue); border-color:transparent; color:white; }
  .seg-btn:hover:not(.active) { border-color:var(--accent); color:var(--accent); }
  /* AOV chip */
  .aov-chip {
    padding:3px 9px; border-radius:14px; font-size:10px; font-weight:700;
    cursor:pointer; border:1px solid var(--border); color:var(--muted); background:transparent; transition:all 0.15s; white-space:nowrap;
  }
  .aov-chip.active { background:rgba(124,92,191,0.85); border-color:transparent; color:white; }
  .aov-chip:hover:not(.active) { border-color:#7c5cbf; color:#7c5cbf; }
  /* range select */
  .range-select {
    background:var(--card2); border:1px solid var(--border); color:var(--text);
    padding:4px 24px 4px 8px; border-radius:8px; font-size:11px; cursor:pointer;
    appearance:none; -webkit-appearance:none;
    background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='8' height='5'%3E%3Cpath d='M0 0l4 5 4-5z' fill='%238892b0'/%3E%3C/svg%3E");
    background-repeat:no-repeat; background-position:right 6px center;
    min-width:110px;
  }
  /* founder toggle */
  .founder-toggle {
    display:flex; align-items:center; gap:6px; cursor:pointer;
    padding:4px 10px; border-radius:20px; border:1px solid var(--border);
    font-size:11px; font-weight:700; color:var(--muted); background:transparent; transition:all 0.15s;
  }
  .founder-toggle.active { background:rgba(241,196,15,0.2); border-color:#f1c40f; color:#f1c40f; }
  .founder-toggle:hover:not(.active) { border-color:#f1c40f; color:#f1c40f; }
  /* filter reset small */
  .filter-clear-btn {
    padding:3px 10px; border-radius:8px; font-size:10px; font-weight:700;
    cursor:pointer; border:1px solid var(--border); color:var(--muted); background:transparent; transition:all 0.15s; margin-left:auto;
  }
  .filter-clear-btn:hover { border-color:var(--accent2); color:var(--accent2); }
  .company-count { font-size:12px; color:var(--muted); white-space:nowrap; }
  .company-sort-select {
    background:var(--card2); border:1px solid var(--border); color:var(--text);
    padding:5px 28px 5px 10px; border-radius:8px; font-size:12px; cursor:pointer;
    appearance:none; -webkit-appearance:none;
    background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6'%3E%3Cpath d='M0 0l5 6 5-6z' fill='%238892b0'/%3E%3C/svg%3E");
    background-repeat:no-repeat; background-position:right 8px center;
    min-width:140px;
  }

  .company-table-wrap { overflow-x:auto; }
  .company-table { width:100%; border-collapse:collapse; font-size:12px; min-width:900px; }
  .company-table th {
    text-align:left; padding:8px 10px; color:var(--muted); font-size:10px; font-weight:700;
    text-transform:uppercase; letter-spacing:0.5px; border-bottom:1px solid var(--border);
    cursor:pointer; user-select:none; white-space:nowrap; position:sticky; top:0; background:var(--card);
  }
  .company-table th:hover { color:var(--accent); }
  .company-table td { padding:8px 10px; border-bottom:1px solid rgba(255,255,255,0.04); vertical-align:middle; }
  .company-table tr:hover td { background:rgba(255,255,255,0.025); }
  .company-name { font-weight:600; max-width:200px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
  .company-pref { font-size:11px; color:var(--accent); font-weight:600; }
  .company-industry { font-size:11px; color:var(--muted); max-width:140px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
  .sf-badge { display:inline-block; padding:2px 8px; border-radius:10px; font-size:10px; font-weight:700; }
  .sf-badge.yes { background:rgba(0,161,224,0.2); color:var(--accent); border:1px solid rgba(0,161,224,0.4); }
  .sf-badge.no  { background:rgba(255,107,53,0.1); color:var(--accent2); border:1px solid rgba(255,107,53,0.3); }
  .score-bar-wrap { display:flex; align-items:center; gap:5px; }
  .score-bar { height:4px; border-radius:2px; background:var(--accent); }
  .products-cell { display:flex; flex-wrap:wrap; gap:3px; }
  .prod-tag {
    font-size:9px; font-weight:700; padding:1px 5px; border-radius:8px; white-space:nowrap;
  }
  .pagination {
    display:flex; align-items:center; justify-content:center; gap:6px; margin-top:16px; flex-wrap:wrap;
  }
  .page-btn {
    padding:5px 12px; border-radius:8px; font-size:12px; font-weight:600; cursor:pointer;
    border:1px solid var(--border); color:var(--muted); background:transparent; transition:all 0.15s;
  }
  .page-btn:hover:not(:disabled) { border-color:var(--accent); color:var(--accent); }
  .page-btn.active { background:var(--sf-blue); border-color:transparent; color:white; }
  .page-btn:disabled { opacity:0.35; cursor:not-allowed; }
  .page-info { font-size:12px; color:var(--muted); }
  .loading-msg { text-align:center; padding:40px; color:var(--muted); font-size:14px; }
  .load-bar { width:200px; height:4px; background:var(--border); border-radius:2px; margin:10px auto; overflow:hidden; }
  .load-bar-inner { height:100%; background:var(--accent); border-radius:2px; animation:loadpulse 1.2s ease-in-out infinite; }
  @keyframes loadpulse { 0%{width:0%} 50%{width:80%} 100%{width:100%} }

  /* compare strip */
  .compare-strip {
    background: linear-gradient(90deg, rgba(0,161,224,0.08), rgba(255,107,53,0.08));
    border: 1px solid rgba(0,161,224,0.2);
    border-radius: 10px;
    padding: 8px 16px;
    display: none;
    align-items: center;
    gap: 12px;
    margin-bottom: 16px;
    font-size: 12px;
  }
  .compare-strip.visible { display:flex; }
  .cstrip-a { color:var(--cmp-a); font-weight:700; }
  .cstrip-b { color:var(--cmp-b); font-weight:700; }
  .cstrip-vs { color:var(--muted); font-size:11px; font-weight:700; }

  @media (max-width: 1100px) {
    .kpi-row { grid-template-columns: repeat(2,1fr); }
    .grid-2, .grid-3 { grid-template-columns: 1fr; }
    .product-grid { grid-template-columns: repeat(3,1fr); }
  }
</style>
</head>
<body>

<!-- ===== PASSWORD GATE ===== -->
<div id="pwGate" style="
  position:fixed;inset:0;z-index:9999;
  background:#0f1117;
  display:flex;align-items:center;justify-content:center;
">
  <div style="
    background:#1a1d27;border:1px solid #2e3350;border-radius:16px;
    padding:40px 48px;text-align:center;width:340px;
    box-shadow:0 24px 64px rgba(0,0,0,.6);
  ">
    <div style="width:48px;height:48px;background:#0176d3;border-radius:12px;
      display:flex;align-items:center;justify-content:center;
      font-size:22px;font-weight:900;color:#fff;margin:0 auto 20px;">S</div>
    <div style="font-size:18px;font-weight:700;color:#e8eaf0;margin-bottom:6px;">SF å°å…¥åˆ†æãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</div>
    <div style="font-size:12px;color:#8892b0;margin-bottom:28px;">Internal Use Only</div>
    <input id="pwInput" type="password" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›" style="
      width:100%;padding:10px 14px;border-radius:8px;
      background:#0f1117;border:1px solid #2e3350;color:#e8eaf0;
      font-size:14px;outline:none;margin-bottom:12px;
    " />
    <div id="pwError" style="font-size:12px;color:#e74c3c;min-height:18px;margin-bottom:10px;"></div>
    <button onclick="checkPw()" style="
      width:100%;padding:10px;border-radius:8px;border:none;
      background:#0176d3;color:#fff;font-size:14px;font-weight:700;cursor:pointer;
    ">ãƒ­ã‚°ã‚¤ãƒ³</button>
  </div>
</div>
<script>
(function(){
  if(sessionStorage.getItem('sf_auth')==='ok'){
    document.getElementById('pwGate').style.display='none';
  }
})();
function checkPw(){
  const v = document.getElementById('pwInput').value;
  if(v==='sfdc1234'){
    sessionStorage.setItem('sf_auth','ok');
    document.getElementById('pwGate').style.display='none';
  } else {
    document.getElementById('pwError').textContent='ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™';
    document.getElementById('pwInput').value='';
    document.getElementById('pwInput').focus();
  }
}
document.addEventListener('DOMContentLoaded',function(){
  const inp = document.getElementById('pwInput');
  if(inp) inp.addEventListener('keydown',function(e){ if(e.key==='Enter') checkPw(); });
});
</script>

<!-- ===== HEADER ===== -->
<div class="header">
  <div class="header-left">
    <div class="logo">SF</div>
    <div>
      <h1>Salesforce å°å…¥åˆ†æãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h1>
      <div class="header-sub">TSRã‚ªãƒ•ãƒ©ã‚¤ãƒ³DB Ã— Org62 | 2025å¹´7æœˆæ™‚ç‚¹</div>
    </div>
  </div>
  <div class="header-right">
    <button class="cmp-toggle-btn" id="cmpToggleBtn">
      <span class="cmp-dot" style="background:var(--cmp-a)"></span>
      <span class="cmp-dot" style="background:var(--cmp-b)"></span>
      æ¯”è¼ƒãƒ¢ãƒ¼ãƒ‰
    </button>
    <div class="badge" id="headerBadge">253,557ç¤¾åˆ†æ</div>
  </div>
</div>

<!-- ===== FILTER BARS ===== -->
<div class="filter-bar-wrap">
  <!-- é€šå¸¸ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒãƒ¼ -->
  <div class="filter-bar" id="normalFilterBar">
    <div class="filter-group">
      <span class="filter-label">åœ°æ–¹</span>
      <div class="chip-row" id="regionChips"></div>
    </div>
    <div class="filter-group">
      <span class="filter-label">éƒ½é“åºœçœŒ</span>
      <select class="filter-select" id="prefSelect"><option value="ALL">å…¨éƒ½é“åºœçœŒ</option></select>
    </div>
    <div class="filter-group">
      <span class="filter-label">ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆ</span>
      <div class="chip-row" id="productChips"></div>
    </div>
    <div class="filter-group">
      <span class="filter-label">AOV</span>
      <div class="chip-row" id="globalAovChips"></div>
    </div>
    <div class="filter-group">
      <span class="filter-label">å‰µæ¥­è€…</span>
      <button class="chip" id="globalFounderChip">ğŸŒ± å‰µæ¥­è€…ã®ã¿</button>
    </div>
    <div class="filter-group">
      <span class="filter-label">ã‚½ãƒ¼ãƒˆ</span>
      <select class="filter-select" id="sortSelect" style="min-width:140px">
        <option value="rate_desc">å°å…¥ç‡ é«˜ã„é †</option>
        <option value="rate_asc">å°å…¥ç‡ ä½ã„é †</option>
        <option value="sf_desc">SFä¼æ¥­æ•° å¤šã„é †</option>
        <option value="ws_desc">ãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒšãƒ¼ã‚¹ å¤šã„é †</option>
        <option value="total_desc">å…¨ä¼æ¥­æ•° å¤šã„é †</option>
      </select>
    </div>
    <button class="filter-reset" id="resetBtn">ğŸ”„ ãƒªã‚»ãƒƒãƒˆ</button>
  </div>

  <!-- æ¯”è¼ƒãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒãƒ¼ -->
  <div class="cmp-filter-bar" id="cmpFilterBar">
    <!-- A -->
    <div class="cmp-row">
      <span class="cmp-label a">A</span>
      <div class="filter-group">
        <span class="filter-label">åœ°æ–¹</span>
        <div class="chip-row" id="cmpRegionChipsA"></div>
      </div>
      <div class="filter-group">
        <span class="filter-label">éƒ½é“åºœçœŒ</span>
        <select class="filter-select" id="cmpPrefSelectA"><option value="ALL">å…¨éƒ½é“åºœçœŒ</option></select>
      </div>
      <div class="filter-group">
        <span class="filter-label">ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆ</span>
        <div class="chip-row" id="cmpProductChipsA"></div>
      </div>
    </div>
    <!-- B -->
    <div class="cmp-row">
      <span class="cmp-label b">B</span>
      <div class="filter-group">
        <span class="filter-label">åœ°æ–¹</span>
        <div class="chip-row" id="cmpRegionChipsB"></div>
      </div>
      <div class="filter-group">
        <span class="filter-label">éƒ½é“åºœçœŒ</span>
        <select class="filter-select" id="cmpPrefSelectB"><option value="ALL">å…¨éƒ½é“åºœçœŒ</option></select>
      </div>
      <div class="filter-group">
        <span class="filter-label">ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆ</span>
        <div class="chip-row" id="cmpProductChipsB"></div>
      </div>
    </div>
  </div>
</div>

<!-- ===== MAIN ===== -->
<div class="main">

  <!-- compare strip (only visible in compare mode) -->
  <div class="compare-strip" id="compareStrip">
    <span>ğŸ“Š æ¯”è¼ƒãƒ¢ãƒ¼ãƒ‰ï¼š</span>
    <span class="cstrip-a" id="cstripA">A: å…¨å›½</span>
    <span class="cstrip-vs">vs</span>
    <span class="cstrip-b" id="cstripB">B: å…¨å›½</span>
    <span style="margin-left:auto;color:var(--muted);font-size:11px">å„ã‚°ãƒ©ãƒ•ã« Aï¼ˆé’ï¼‰vs Bï¼ˆã‚ªãƒ¬ãƒ³ã‚¸ï¼‰ã®ãƒ‡ãƒ¼ã‚¿ã‚’é‡ã­ã¦è¡¨ç¤ºã—ã¦ã„ã¾ã™</span>
  </div>

  <!-- KPI -->
  <div class="kpi-row">
    <div class="kpi-card" style="--accent-color:#0176d3">
      <div class="kpi-label">å…¨ä¼æ¥­æ•°</div>
      <div id="kpi-total-wrap">
        <div class="kpi-value" style="color:#0176d3" id="kpi-total">253,557</div>
        <div class="kpi-sub">å¯¾è±¡ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼å†…</div>
      </div>
      <div class="kpi-icon">ğŸ¢</div>
    </div>
    <div class="kpi-card" style="--accent-color:#00a1e0">
      <div class="kpi-label">SFå°å…¥ä¼æ¥­æ•°</div>
      <div id="kpi-sf-wrap">
        <div class="kpi-value" style="color:#00a1e0" id="kpi-sf">19,761</div>
        <div class="kpi-sub" id="kpi-sf-sub">å…¨ä½“ã® 7.8%</div>
      </div>
      <div class="kpi-icon">â˜ï¸</div>
    </div>
    <div class="kpi-card" style="--accent-color:#ff6b35">
      <div class="kpi-label">ãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒšãƒ¼ã‚¹</div>
      <div id="kpi-ws-wrap">
        <div class="kpi-value" style="color:#ff6b35" id="kpi-ws">228,728</div>
        <div class="kpi-sub" id="kpi-ws-sub">SFæœªå°å…¥ã®æ½œåœ¨é¡§å®¢</div>
      </div>
      <div class="kpi-icon">ğŸ¯</div>
    </div>
    <div class="kpi-card" style="--accent-color:#7c5cbf">
      <div class="kpi-label">SFå°å…¥ç‡</div>
      <div id="kpi-rate-wrap">
        <div class="kpi-value" style="color:#7c5cbf" id="kpi-rate">7.8%</div>
        <div class="kpi-sub" id="kpi-rate-sub">ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼å†…å¹³å‡</div>
      </div>
      <div class="kpi-icon">ğŸ“Š</div>
    </div>
  </div>

  <!-- Row 1: å°å…¥ç‡æ£’ã‚°ãƒ©ãƒ• + ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã‚·ã‚§ã‚¢ -->
  <div class="grid-3">
    <div class="card">
      <div class="card-title">
        <span class="dot" style="background:#00a1e0"></span>
        éƒ½é“åºœçœŒåˆ¥ SFå°å…¥ç‡
        <span class="active-filter-hint" id="prefRateHint"></span>
      </div>
      <div class="chart-wrap h340"><canvas id="prefRateChart"></canvas></div>
    </div>
    <div class="card">
      <div class="card-title">
        <span class="dot" style="background:#ff6b35"></span>
        ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆåˆ¥ SFä¼æ¥­å†…ã‚·ã‚§ã‚¢
      </div>
      <div class="product-grid" id="productCards"></div>
      <div class="chart-wrap h240"><canvas id="productDonut"></canvas></div>
    </div>
  </div>

  <!-- Row 2: ãƒ†ãƒ¼ãƒ–ãƒ« + ç©ã¿ä¸Šã’æ£’ -->
  <div class="grid-2">
    <div class="card">
      <div class="card-title">
        <span class="dot" style="background:#2ecc71"></span>
        éƒ½é“åºœçœŒåˆ¥ è©³ç´°ãƒ©ãƒ³ã‚­ãƒ³ã‚°
        <span class="active-filter-hint" id="tableHint"></span>
      </div>
      <div class="scroll-y">
        <table class="pref-table">
          <thead id="tableHead"></thead>
          <tbody id="tableBody"></tbody>
        </table>
      </div>
    </div>
    <div class="card">
      <div class="card-title">
        <span class="dot" style="background:#f1c40f"></span>
        SFå°å…¥ vs ãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒšãƒ¼ã‚¹ï¼ˆä¸Šä½15ï¼‰
        <span class="active-filter-hint" id="stackedHint"></span>
      </div>
      <div class="chart-wrap h340"><canvas id="stackedBar"></canvas></div>
    </div>
  </div>

  <!-- Row 3: çµ¶å¯¾æ•° + æ•£å¸ƒå›³ -->
  <div class="grid-2">
    <div class="card">
      <div class="card-title">
        <span class="dot" style="background:#00a1e0"></span>
        ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆåˆ¥ SFä¼æ¥­æ•°ï¼ˆä¸Šä½15éƒ½é“åºœçœŒï¼‰
        <span class="active-filter-hint" id="countHint"></span>
      </div>
      <div class="chart-wrap h340"><canvas id="sfCountChart"></canvas></div>
    </div>
    <div class="card">
      <div class="card-title">
        <span class="dot" style="background:#f1c40f"></span>
        å°å…¥ç‡ vs ãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒšãƒ¼ã‚¹ï¼ˆæ•£å¸ƒå›³ï¼‰
      </div>
      <div class="chart-wrap h340"><canvas id="scatterChart"></canvas></div>
    </div>
  </div>

  <!-- ===== COMPANY LIST ===== -->
  <div class="company-section full">
    <div class="card">
      <div class="card-title">
        <span class="dot" style="background:#2ecc71"></span>
        ä¼æ¥­ä¸€è¦§
        <span class="active-filter-hint" id="companyHint"></span>
      </div>
      <!-- ãƒ„ãƒ¼ãƒ«ãƒãƒ¼è¡Œ1: æ¤œç´¢ãƒ»SFçµã‚Šè¾¼ã¿ãƒ»ã‚½ãƒ¼ãƒˆ -->
      <div class="company-toolbar">
        <input class="company-search" id="companySearch" placeholder="ğŸ” ä¼šç¤¾åãƒ»æ¥­ç¨®ã§æ¤œç´¢...">
        <div style="display:flex;gap:5px">
          <button class="seg-btn active" data-sf="all">å…¨ç¤¾</button>
          <button class="seg-btn" data-sf="sf">SFå°å…¥</button>
          <button class="seg-btn" data-sf="ws">ãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒšãƒ¼ã‚¹</button>
        </div>
        <button class="founder-toggle" id="founderToggle">ğŸŒ± å‰µæ¥­è€…ãƒ•ãƒ©ã‚°</button>
        <select class="company-sort-select" id="companySortSel">
          <option value="sales_desc">å£²ä¸Šé«˜ é«˜ã„é †</option>
          <option value="sales_asc">å£²ä¸Šé«˜ ä½ã„é †</option>
          <option value="emp_desc">å¾“æ¥­å“¡æ•° å¤šã„é †</option>
          <option value="score_desc">è©•ç‚¹ é«˜ã„é †</option>
          <option value="rate_desc">SFå°å…¥ç‡ é«˜ã„é †</option>
        </select>
        <span class="company-count" id="companyCount">èª­ã¿è¾¼ã¿ä¸­...</span>
      </div>
      <!-- ãƒ„ãƒ¼ãƒ«ãƒãƒ¼è¡Œ2: è©³ç´°ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ -->
      <div class="company-filter-row">
        <!-- AOV Band -->
        <div class="company-filter-group">
          <span class="company-filter-label">AOV Band</span>
          <div id="aovChips" style="display:flex;gap:4px;flex-wrap:wrap"></div>
        </div>
        <!-- å£²ä¸Šé«˜ -->
        <div class="company-filter-group">
          <span class="company-filter-label">å£²ä¸Šé«˜</span>
          <select class="range-select" id="salesMinSel">
            <option value="0">ä¸‹é™ãªã—</option>
            <option value="100000">1å„„ä»¥ä¸Š</option>
            <option value="1000000">10å„„ä»¥ä¸Š</option>
            <option value="10000000">100å„„ä»¥ä¸Š</option>
            <option value="1000000000">1å…†ä»¥ä¸Š</option>
          </select>
          <span style="color:var(--muted);font-size:11px">ã€œ</span>
          <select class="range-select" id="salesMaxSel">
            <option value="999999999999">ä¸Šé™ãªã—</option>
            <option value="100000">1å„„æœªæº€</option>
            <option value="1000000">10å„„æœªæº€</option>
            <option value="10000000">100å„„æœªæº€</option>
            <option value="1000000000">1å…†æœªæº€</option>
          </select>
        </div>
        <!-- å¾“æ¥­å“¡æ•° -->
        <div class="company-filter-group">
          <span class="company-filter-label">å¾“æ¥­å“¡æ•°</span>
          <select class="range-select" id="empMinSel">
            <option value="0">ä¸‹é™ãªã—</option>
            <option value="10">10åä»¥ä¸Š</option>
            <option value="50">50åä»¥ä¸Š</option>
            <option value="100">100åä»¥ä¸Š</option>
            <option value="500">500åä»¥ä¸Š</option>
            <option value="1000">1,000åä»¥ä¸Š</option>
            <option value="5000">5,000åä»¥ä¸Š</option>
          </select>
          <span style="color:var(--muted);font-size:11px">ã€œ</span>
          <select class="range-select" id="empMaxSel">
            <option value="9999999">ä¸Šé™ãªã—</option>
            <option value="9">9åä»¥ä¸‹</option>
            <option value="49">49åä»¥ä¸‹</option>
            <option value="99">99åä»¥ä¸‹</option>
            <option value="499">499åä»¥ä¸‹</option>
            <option value="999">999åä»¥ä¸‹</option>
            <option value="4999">4,999åä»¥ä¸‹</option>
          </select>
        </div>
        <!-- è©•ç‚¹ -->
        <div class="company-filter-group">
          <span class="company-filter-label">è©•ç‚¹</span>
          <select class="range-select" id="scoreMinSel">
            <option value="0">ä¸‹é™ãªã—</option>
            <option value="40">40ä»¥ä¸Š</option>
            <option value="50">50ä»¥ä¸Š</option>
            <option value="60">60ä»¥ä¸Š</option>
            <option value="70">70ä»¥ä¸Š</option>
          </select>
        </div>
        <button class="filter-clear-btn" id="companyFilterClear">ğŸ”„ ãƒªã‚»ãƒƒãƒˆ</button>
      </div>
      <div id="companyTableWrap" class="company-table-wrap">
        <div class="loading-msg">
          ä¼æ¥­ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...<br>
          <div class="load-bar"><div class="load-bar-inner"></div></div>
          <span style="font-size:11px;color:var(--muted)">companies.jsonã‚’å–å¾—ä¸­ (ç´„100MB)</span>
        </div>
      </div>
      <div class="pagination" id="companyPagination"></div>
    </div>
  </div>

</div><!-- /main -->

<script>
// ============================================================
// PREF DATA (embedded)
// ============================================================
const prefData = [{"éƒ½é“åºœçœŒ":"æ±äº¬éƒ½","å…¨ä¼æ¥­æ•°":39167,"SFå°å…¥ä¼æ¥­æ•°":13875,"å‰µæ¥­è€…ãƒ•ãƒ©ã‚°ä¼æ¥­æ•°":6558,"SFå°å…¥ç‡(%)":35.43,"ãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒšãƒ¼ã‚¹æ•°":25292,"L1 Sales_å°å…¥æ•°":7178,"L1 Service_å°å…¥æ•°":4891,"L1 Slack_å°å…¥æ•°":5984,"L1 AI and Data_å°å…¥æ•°":920,"L1 Analytics_å°å…¥æ•°":5736,"L1 Integration_å°å…¥æ•°":592},{"éƒ½é“åºœçœŒ":"å¤§é˜ªåºœ","å…¨ä¼æ¥­æ•°":17881,"SFå°å…¥ä¼æ¥­æ•°":1982,"å‰µæ¥­è€…ãƒ•ãƒ©ã‚°ä¼æ¥­æ•°":2281,"SFå°å…¥ç‡(%)":11.08,"ãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒšãƒ¼ã‚¹æ•°":15899,"L1 Sales_å°å…¥æ•°":985,"L1 Service_å°å…¥æ•°":662,"L1 Slack_å°å…¥æ•°":554,"L1 AI and Data_å°å…¥æ•°":93,"L1 Analytics_å°å…¥æ•°":743,"L1 Integration_å°å…¥æ•°":50},{"éƒ½é“åºœçœŒ":"æ„›çŸ¥çœŒ","å…¨ä¼æ¥­æ•°":13178,"SFå°å…¥ä¼æ¥­æ•°":1319,"å‰µæ¥­è€…ãƒ•ãƒ©ã‚°ä¼æ¥­æ•°":1334,"SFå°å…¥ç‡(%)":10.01,"ãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒšãƒ¼ã‚¹æ•°":11859,"L1 Sales_å°å…¥æ•°":766,"L1 Service_å°å…¥æ•°":566,"L1 Slack_å°å…¥æ•°":592,"L1 AI and Data_å°å…¥æ•°":368,"L1 Analytics_å°å…¥æ•°":680,"L1 Integration_å°å…¥æ•°":364},{"éƒ½é“åºœçœŒ":"äº¬éƒ½åºœ","å…¨ä¼æ¥­æ•°":5004,"SFå°å…¥ä¼æ¥­æ•°":412,"å‰µæ¥­è€…ãƒ•ãƒ©ã‚°ä¼æ¥­æ•°":486,"SFå°å…¥ç‡(%)":8.23,"ãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒšãƒ¼ã‚¹æ•°":4592,"L1 Sales_å°å…¥æ•°":187,"L1 Service_å°å…¥æ•°":153,"L1 Slack_å°å…¥æ•°":112,"L1 AI and Data_å°å…¥æ•°":30,"L1 Analytics_å°å…¥æ•°":143,"L1 Integration_å°å…¥æ•°":24},{"éƒ½é“åºœçœŒ":"ç¥å¥ˆå·çœŒ","å…¨ä¼æ¥­æ•°":12755,"SFå°å…¥ä¼æ¥­æ•°":1043,"å‰µæ¥­è€…ãƒ•ãƒ©ã‚°ä¼æ¥­æ•°":1497,"SFå°å…¥ç‡(%)":8.18,"ãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒšãƒ¼ã‚¹æ•°":11712,"L1 Sales_å°å…¥æ•°":443,"L1 Service_å°å…¥æ•°":318,"L1 Slack_å°å…¥æ•°":220,"L1 AI and Data_å°å…¥æ•°":54,"L1 Analytics_å°å…¥æ•°":358,"L1 Integration_å°å…¥æ•°":26},{"éƒ½é“åºœçœŒ":"ç¦å²¡çœŒ","å…¨ä¼æ¥­æ•°":9510,"SFå°å…¥ä¼æ¥­æ•°":681,"å‰µæ¥­è€…ãƒ•ãƒ©ã‚°ä¼æ¥­æ•°":1167,"SFå°å…¥ç‡(%)":7.16,"ãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒšãƒ¼ã‚¹æ•°":8829,"L1 Sales_å°å…¥æ•°":312,"L1 Service_å°å…¥æ•°":160,"L1 Slack_å°å…¥æ•°":155,"L1 AI and Data_å°å…¥æ•°":15,"L1 Analytics_å°å…¥æ•°":206,"L1 Integration_å°å…¥æ•°":12},{"éƒ½é“åºœçœŒ":"æ²–ç¸„çœŒ","å…¨ä¼æ¥­æ•°":2737,"SFå°å…¥ä¼æ¥­æ•°":163,"å‰µæ¥­è€…ãƒ•ãƒ©ã‚°ä¼æ¥­æ•°":362,"SFå°å…¥ç‡(%)":5.96,"ãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒšãƒ¼ã‚¹æ•°":2574,"L1 Sales_å°å…¥æ•°":68,"L1 Service_å°å…¥æ•°":36,"L1 Slack_å°å…¥æ•°":33,"L1 AI and Data_å°å…¥æ•°":2,"L1 Analytics_å°å…¥æ•°":25,"L1 Integration_å°å…¥æ•°":2},{"éƒ½é“åºœçœŒ":"å¯Œå±±çœŒ","å…¨ä¼æ¥­æ•°":2474,"SFå°å…¥ä¼æ¥­æ•°":137,"å‰µæ¥­è€…ãƒ•ãƒ©ã‚°ä¼æ¥­æ•°":159,"SFå°å…¥ç‡(%)":5.54,"ãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒšãƒ¼ã‚¹æ•°":2337,"L1 Sales_å°å…¥æ•°":48,"L1 Service_å°å…¥æ•°":29,"L1 Slack_å°å…¥æ•°":10,"L1 AI and Data_å°å…¥æ•°":0,"L1 Analytics_å°å…¥æ•°":33,"L1 Integration_å°å…¥æ•°":0},{"éƒ½é“åºœçœŒ":"å…µåº«çœŒ","å…¨ä¼æ¥­æ•°":8948,"SFå°å…¥ä¼æ¥­æ•°":477,"å‰µæ¥­è€…ãƒ•ãƒ©ã‚°ä¼æ¥­æ•°":788,"SFå°å…¥ç‡(%)":5.33,"ãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒšãƒ¼ã‚¹æ•°":8471,"L1 Sales_å°å…¥æ•°":186,"L1 Service_å°å…¥æ•°":118,"L1 Slack_å°å…¥æ•°":98,"L1 AI and Data_å°å…¥æ•°":3,"L1 Analytics_å°å…¥æ•°":170,"L1 Integration_å°å…¥æ•°":1},{"éƒ½é“åºœçœŒ":"å²¡å±±çœŒ","å…¨ä¼æ¥­æ•°":4014,"SFå°å…¥ä¼æ¥­æ•°":206,"å‰µæ¥­è€…ãƒ•ãƒ©ã‚°ä¼æ¥­æ•°":356,"SFå°å…¥ç‡(%)":5.13,"ãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒšãƒ¼ã‚¹æ•°":3808,"L1 Sales_å°å…¥æ•°":104,"L1 Service_å°å…¥æ•°":59,"L1 Slack_å°å…¥æ•°":68,"L1 AI and Data_å°å…¥æ•°":1,"L1 Analytics_å°å…¥æ•°":79,"L1 Integration_å°å…¥æ•°":17},{"éƒ½é“åºœçœŒ":"åºƒå³¶çœŒ","å…¨ä¼æ¥­æ•°":6223,"SFå°å…¥ä¼æ¥­æ•°":317,"å‰µæ¥­è€…ãƒ•ãƒ©ã‚°ä¼æ¥­æ•°":595,"SFå°å…¥ç‡(%)":5.09,"ãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒšãƒ¼ã‚¹æ•°":5906,"L1 Sales_å°å…¥æ•°":153,"L1 Service_å°å…¥æ•°":108,"L1 Slack_å°å…¥æ•°":79,"L1 AI and Data_å°å…¥æ•°":50,"L1 Analytics_å°å…¥æ•°":133,"L1 Integration_å°å…¥æ•°":43},{"éƒ½é“åºœçœŒ":"çŸ³å·çœŒ","å…¨ä¼æ¥­æ•°":2535,"SFå°å…¥ä¼æ¥­æ•°":127,"å‰µæ¥­è€…ãƒ•ãƒ©ã‚°ä¼æ¥­æ•°":178,"SFå°å…¥ç‡(%)":5.01,"ãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒšãƒ¼ã‚¹æ•°":2408,"L1 Sales_å°å…¥æ•°":36,"L1 Service_å°å…¥æ•°":25,"L1 Slack_å°å…¥æ•°":22,"L1 AI and Data_å°å…¥æ•°":0,"L1 Analytics_å°å…¥æ•°":47,"L1 Integration_å°å…¥æ•°":0},{"éƒ½é“åºœçœŒ":"åƒè‘‰çœŒ","å…¨ä¼æ¥­æ•°":8418,"SFå°å…¥ä¼æ¥­æ•°":371,"å‰µæ¥­è€…ãƒ•ãƒ©ã‚°ä¼æ¥­æ•°":1062,"SFå°å…¥ç‡(%)":4.41,"ãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒšãƒ¼ã‚¹æ•°":8047,"L1 Sales_å°å…¥æ•°":144,"L1 Service_å°å…¥æ•°":102,"L1 Slack_å°å…¥æ•°":70,"L1 AI and Data_å°å…¥æ•°":3,"L1 Analytics_å°å…¥æ•°":89,"L1 Integration_å°å…¥æ•°":3},{"éƒ½é“åºœçœŒ":"é™å²¡çœŒ","å…¨ä¼æ¥­æ•°":6871,"SFå°å…¥ä¼æ¥­æ•°":285,"å‰µæ¥­è€…ãƒ•ãƒ©ã‚°ä¼æ¥­æ•°":579,"SFå°å…¥ç‡(%)":4.15,"ãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒšãƒ¼ã‚¹æ•°":6586,"L1 Sales_å°å…¥æ•°":137,"L1 Service_å°å…¥æ•°":65,"L1 Slack_å°å…¥æ•°":58,"L1 AI and Data_å°å…¥æ•°":19,"L1 Analytics_å°å…¥æ•°":87,"L1 Integration_å°å…¥æ•°":5},{"éƒ½é“åºœçœŒ":"é¹¿å…å³¶çœŒ","å…¨ä¼æ¥­æ•°":2909,"SFå°å…¥ä¼æ¥­æ•°":120,"å‰µæ¥­è€…ãƒ•ãƒ©ã‚°ä¼æ¥­æ•°":229,"SFå°å…¥ç‡(%)":4.13,"ãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒšãƒ¼ã‚¹æ•°":2789,"L1 Sales_å°å…¥æ•°":62,"L1 Service_å°å…¥æ•°":19,"L1 Slack_å°å…¥æ•°":13,"L1 AI and Data_å°å…¥æ•°":2,"L1 Analytics_å°å…¥æ•°":14,"L1 Integration_å°å…¥æ•°":0},{"éƒ½é“åºœçœŒ":"ç†Šæœ¬çœŒ","å…¨ä¼æ¥­æ•°":3524,"SFå°å…¥ä¼æ¥­æ•°":145,"å‰µæ¥­è€…ãƒ•ãƒ©ã‚°ä¼æ¥­æ•°":291,"SFå°å…¥ç‡(%)":4.11,"ãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒšãƒ¼ã‚¹æ•°":3379,"L1 Sales_å°å…¥æ•°":74,"L1 Service_å°å…¥æ•°":10,"L1 Slack_å°å…¥æ•°":19,"L1 AI and Data_å°å…¥æ•°":0,"L1 Analytics_å°å…¥æ•°":33,"L1 Integration_å°å…¥æ•°":1},{"éƒ½é“åºœçœŒ":"åŸ¼ç‰çœŒ","å…¨ä¼æ¥­æ•°":10281,"SFå°å…¥ä¼æ¥­æ•°":410,"å‰µæ¥­è€…ãƒ•ãƒ©ã‚°ä¼æ¥­æ•°":1133,"SFå°å…¥ç‡(%)":3.99,"ãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒšãƒ¼ã‚¹æ•°":9871,"L1 Sales_å°å…¥æ•°":178,"L1 Service_å°å…¥æ•°":108,"L1 Slack_å°å…¥æ•°":61,"L1 AI and Data_å°å…¥æ•°":7,"L1 Analytics_å°å…¥æ•°":101,"L1 Integration_å°å…¥æ•°":9},{"éƒ½é“åºœçœŒ":"ä½è³€çœŒ","å…¨ä¼æ¥­æ•°":1902,"SFå°å…¥ä¼æ¥­æ•°":72,"å‰µæ¥­è€…ãƒ•ãƒ©ã‚°ä¼æ¥­æ•°":123,"SFå°å…¥ç‡(%)":3.79,"ãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒšãƒ¼ã‚¹æ•°":1830,"L1 Sales_å°å…¥æ•°":33,"L1 Service_å°å…¥æ•°":8,"L1 Slack_å°å…¥æ•°":7,"L1 AI and Data_å°å…¥æ•°":0,"L1 Analytics_å°å…¥æ•°":6,"L1 Integration_å°å…¥æ•°":0},{"éƒ½é“åºœçœŒ":"å®®åŸçœŒ","å…¨ä¼æ¥­æ•°":4492,"SFå°å…¥ä¼æ¥­æ•°":162,"å‰µæ¥­è€…ãƒ•ãƒ©ã‚°ä¼æ¥­æ•°":731,"SFå°å…¥ç‡(%)":3.61,"ãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒšãƒ¼ã‚¹æ•°":4330,"L1 Sales_å°å…¥æ•°":61,"L1 Service_å°å…¥æ•°":31,"L1 Slack_å°å…¥æ•°":26,"L1 AI and Data_å°å…¥æ•°":1,"L1 Analytics_å°å…¥æ•°":48,"L1 Integration_å°å…¥æ•°":5},{"éƒ½é“åºœçœŒ":"é•·é‡çœŒ","å…¨ä¼æ¥­æ•°":4753,"SFå°å…¥ä¼æ¥­æ•°":171,"å‰µæ¥­è€…ãƒ•ãƒ©ã‚°ä¼æ¥­æ•°":378,"SFå°å…¥ç‡(%)":3.6,"ãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒšãƒ¼ã‚¹æ•°":4582,"L1 Sales_å°å…¥æ•°":73,"L1 Service_å°å…¥æ•°":34,"L1 Slack_å°å…¥æ•°":18,"L1 AI and Data_å°å…¥æ•°":4,"L1 Analytics_å°å…¥æ•°":36,"L1 Integration_å°å…¥æ•°":2},{"éƒ½é“åºœçœŒ":"å±±æ¢¨çœŒ","å…¨ä¼æ¥­æ•°":2001,"SFå°å…¥ä¼æ¥­æ•°":71,"å‰µæ¥­è€…ãƒ•ãƒ©ã‚°ä¼æ¥­æ•°":154,"SFå°å…¥ç‡(%)":3.55,"ãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒšãƒ¼ã‚¹æ•°":1930,"L1 Sales_å°å…¥æ•°":19,"L1 Service_å°å…¥æ•°":15,"L1 Slack_å°å…¥æ•°":8,"L1 AI and Data_å°å…¥æ•°":0,"L1 Analytics_å°å…¥æ•°":24,"L1 Integration_å°å…¥æ•°":0},{"éƒ½é“åºœçœŒ":"æ»‹è³€çœŒ","å…¨ä¼æ¥­æ•°":2297,"SFå°å…¥ä¼æ¥­æ•°":80,"å‰µæ¥­è€…ãƒ•ãƒ©ã‚°ä¼æ¥­æ•°":150,"SFå°å…¥ç‡(%)":3.48,"ãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒšãƒ¼ã‚¹æ•°":2217,"L1 Sales_å°å…¥æ•°":31,"L1 Service_å°å…¥æ•°":18,"L1 Slack_å°å…¥æ•°":10,"L1 AI and Data_å°å…¥æ•°":3,"L1 Analytics_å°å…¥æ•°":22,"L1 Integration_å°å…¥æ•°":0},{"éƒ½é“åºœçœŒ":"æ–°æ½ŸçœŒ","å…¨ä¼æ¥­æ•°":4824,"SFå°å…¥ä¼æ¥­æ•°":166,"å‰µæ¥­è€…ãƒ•ãƒ©ã‚°ä¼æ¥­æ•°":333,"SFå°å…¥ç‡(%)":3.44,"ãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒšãƒ¼ã‚¹æ•°":4658,"L1 Sales_å°å…¥æ•°":62,"L1 Service_å°å…¥æ•°":36,"L1 Slack_å°å…¥æ•°":31,"L1 AI and Data_å°å…¥æ•°":1,"L1 Analytics_å°å…¥æ•°":46,"L1 Integration_å°å…¥æ•°":1},{"éƒ½é“åºœçœŒ":"é¦™å·çœŒ","å…¨ä¼æ¥­æ•°":2405,"SFå°å…¥ä¼æ¥­æ•°":82,"å‰µæ¥­è€…ãƒ•ãƒ©ã‚°ä¼æ¥­æ•°":213,"SFå°å…¥ç‡(%)":3.41,"ãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒšãƒ¼ã‚¹æ•°":2323,"L1 Sales_å°å…¥æ•°":32,"L1 Service_å°å…¥æ•°":16,"L1 Slack_å°å…¥æ•°":16,"L1 AI and Data_å°å…¥æ•°":1,"L1 Analytics_å°å…¥æ•°":18,"L1 Integration_å°å…¥æ•°":2},{"éƒ½é“åºœçœŒ":"å²é˜œçœŒ","å…¨ä¼æ¥­æ•°":3736,"SFå°å…¥ä¼æ¥­æ•°":126,"å‰µæ¥­è€…ãƒ•ãƒ©ã‚°ä¼æ¥­æ•°":273,"SFå°å…¥ç‡(%)":3.37,"ãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒšãƒ¼ã‚¹æ•°":3610,"L1 Sales_å°å…¥æ•°":62,"L1 Service_å°å…¥æ•°":26,"L1 Slack_å°å…¥æ•°":31,"L1 AI and Data_å°å…¥æ•°":2,"L1 Analytics_å°å…¥æ•°":36,"L1 Integration_å°å…¥æ•°":0},{"éƒ½é“åºœçœŒ":"é•·å´çœŒ","å…¨ä¼æ¥­æ•°":2435,"SFå°å…¥ä¼æ¥­æ•°":78,"å‰µæ¥­è€…ãƒ•ãƒ©ã‚°ä¼æ¥­æ•°":160,"SFå°å…¥ç‡(%)":3.2,"ãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒšãƒ¼ã‚¹æ•°":2357,"L1 Sales_å°å…¥æ•°":28,"L1 Service_å°å…¥æ•°":17,"L1 Slack_å°å…¥æ•°":9,"L1 AI and Data_å°å…¥æ•°":2,"L1 Analytics_å°å…¥æ•°":22,"L1 Integration_å°å…¥æ•°":0},{"éƒ½é“åºœçœŒ":"æ„›åª›çœŒ","å…¨ä¼æ¥­æ•°":2998,"SFå°å…¥ä¼æ¥­æ•°":95,"å‰µæ¥­è€…ãƒ•ãƒ©ã‚°ä¼æ¥­æ•°":290,"SFå°å…¥ç‡(%)":3.17,"ãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒšãƒ¼ã‚¹æ•°":2903,"L1 Sales_å°å…¥æ•°":34,"L1 Service_å°å…¥æ•°":10,"L1 Slack_å°å…¥æ•°":16,"L1 AI and Data_å°å…¥æ•°":0,"L1 Analytics_å°å…¥æ•°":21,"L1 Integration_å°å…¥æ•°":0},{"éƒ½é“åºœçœŒ":"ä¸‰é‡çœŒ","å…¨ä¼æ¥­æ•°":3721,"SFå°å…¥ä¼æ¥­æ•°":116,"å‰µæ¥­è€…ãƒ•ãƒ©ã‚°ä¼æ¥­æ•°":303,"SFå°å…¥ç‡(%)":3.12,"ãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒšãƒ¼ã‚¹æ•°":3605,"L1 Sales_å°å…¥æ•°":41,"L1 Service_å°å…¥æ•°":17,"L1 Slack_å°å…¥æ•°":16,"L1 AI and Data_å°å…¥æ•°":2,"L1 Analytics_å°å…¥æ•°":29,"L1 Integration_å°å…¥æ•°":0},{"éƒ½é“åºœçœŒ":"é«˜çŸ¥çœŒ","å…¨ä¼æ¥­æ•°":1581,"SFå°å…¥ä¼æ¥­æ•°":49,"å‰µæ¥­è€…ãƒ•ãƒ©ã‚°ä¼æ¥­æ•°":103,"SFå°å…¥ç‡(%)":3.1,"ãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒšãƒ¼ã‚¹æ•°":1532,"L1 Sales_å°å…¥æ•°":12,"L1 Service_å°å…¥æ•°":13,"L1 Slack_å°å…¥æ•°":12,"L1 AI and Data_å°å…¥æ•°":0,"L1 Analytics_å°å…¥æ•°":21,"L1 Integration_å°å…¥æ•°":0},{"éƒ½é“åºœçœŒ":"å±±å½¢çœŒ","å…¨ä¼æ¥­æ•°":2621,"SFå°å…¥ä¼æ¥­æ•°":78,"å‰µæ¥­è€…ãƒ•ãƒ©ã‚°ä¼æ¥­æ•°":180,"SFå°å…¥ç‡(%)":2.98,"ãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒšãƒ¼ã‚¹æ•°":2543,"L1 Sales_å°å…¥æ•°":36,"L1 Service_å°å…¥æ•°":5,"L1 Slack_å°å…¥æ•°":13,"L1 AI and Data_å°å…¥æ•°":0,"L1 Analytics_å°å…¥æ•°":10,"L1 Integration_å°å…¥æ•°":0},{"éƒ½é“åºœçœŒ":"å¤§åˆ†çœŒ","å…¨ä¼æ¥­æ•°":2548,"SFå°å…¥ä¼æ¥­æ•°":76,"å‰µæ¥­è€…ãƒ•ãƒ©ã‚°ä¼æ¥­æ•°":267,"SFå°å…¥ç‡(%)":2.98,"ãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒšãƒ¼ã‚¹æ•°":2472,"L1 Sales_å°å…¥æ•°":22,"L1 Service_å°å…¥æ•°":15,"L1 Slack_å°å…¥æ•°":19,"L1 AI and Data_å°å…¥æ•°":0,"L1 Analytics_å°å…¥æ•°":24,"L1 Integration_å°å…¥æ•°":0},{"éƒ½é“åºœçœŒ":"é³¥å–çœŒ","å…¨ä¼æ¥­æ•°":1327,"SFå°å…¥ä¼æ¥­æ•°":39,"å‰µæ¥­è€…ãƒ•ãƒ©ã‚°ä¼æ¥­æ•°":106,"SFå°å…¥ç‡(%)":2.94,"ãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒšãƒ¼ã‚¹æ•°":1288,"L1 Sales_å°å…¥æ•°":15,"L1 Service_å°å…¥æ•°":7,"L1 Slack_å°å…¥æ•°":3,"L1 AI and Data_å°å…¥æ•°":0,"L1 Analytics_å°å…¥æ•°":13,"L1 Integration_å°å…¥æ•°":0},{"éƒ½é“åºœçœŒ":"å±±å£çœŒ","å…¨ä¼æ¥­æ•°":2658,"SFå°å…¥ä¼æ¥­æ•°":76,"å‰µæ¥­è€…ãƒ•ãƒ©ã‚°ä¼æ¥­æ•°":176,"SFå°å…¥ç‡(%)":2.86,"ãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒšãƒ¼ã‚¹æ•°":2582,"L1 Sales_å°å…¥æ•°":31,"L1 Service_å°å…¥æ•°":13,"L1 Slack_å°å…¥æ•°":14,"L1 AI and Data_å°å…¥æ•°":0,"L1 Analytics_å°å…¥æ•°":20,"L1 Integration_å°å…¥æ•°":1},{"éƒ½é“åºœçœŒ":"ç¾¤é¦¬çœŒ","å…¨ä¼æ¥­æ•°":4156,"SFå°å…¥ä¼æ¥­æ•°":118,"å‰µæ¥­è€…ãƒ•ãƒ©ã‚°ä¼æ¥­æ•°":379,"SFå°å…¥ç‡(%)":2.84,"ãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒšãƒ¼ã‚¹æ•°":4038,"L1 Sales_å°å…¥æ•°":41,"L1 Service_å°å…¥æ•°":21,"L1 Slack_å°å…¥æ•°":20,"L1 AI and Data_å°å…¥æ•°":0,"L1 Analytics_å°å…¥æ•°":28,"L1 Integration_å°å…¥æ•°":0},{"éƒ½é“åºœçœŒ":"æ ƒæœ¨çœŒ","å…¨ä¼æ¥­æ•°":3699,"SFå°å…¥ä¼æ¥­æ•°":105,"å‰µæ¥­è€…ãƒ•ãƒ©ã‚°ä¼æ¥­æ•°":323,"SFå°å…¥ç‡(%)":2.84,"ãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒšãƒ¼ã‚¹æ•°":3594,"L1 Sales_å°å…¥æ•°":37,"L1 Service_å°å…¥æ•°":20,"L1 Slack_å°å…¥æ•°":19,"L1 AI and Data_å°å…¥æ•°":1,"L1 Analytics_å°å…¥æ•°":24,"L1 Integration_å°å…¥æ•°":0},{"éƒ½é“åºœçœŒ":"ç¦äº•çœŒ","å…¨ä¼æ¥­æ•°":2242,"SFå°å…¥ä¼æ¥­æ•°":62,"å‰µæ¥­è€…ãƒ•ãƒ©ã‚°ä¼æ¥­æ•°":94,"SFå°å…¥ç‡(%)":2.77,"ãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒšãƒ¼ã‚¹æ•°":2180,"L1 Sales_å°å…¥æ•°":18,"L1 Service_å°å…¥æ•°":16,"L1 Slack_å°å…¥æ•°":15,"L1 AI and Data_å°å…¥æ•°":0,"L1 Analytics_å°å…¥æ•°":18,"L1 Integration_å°å…¥æ•°":0},{"éƒ½é“åºœçœŒ":"åŒ—æµ·é“","å…¨ä¼æ¥­æ•°":14098,"SFå°å…¥ä¼æ¥­æ•°":381,"å‰µæ¥­è€…ãƒ•ãƒ©ã‚°ä¼æ¥­æ•°":1587,"SFå°å…¥ç‡(%)":2.7,"ãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒšãƒ¼ã‚¹æ•°":13717,"L1 Sales_å°å…¥æ•°":137,"L1 Service_å°å…¥æ•°":66,"L1 Slack_å°å…¥æ•°":98,"L1 AI and Data_å°å…¥æ•°":6,"L1 Analytics_å°å…¥æ•°":92,"L1 Integration_å°å…¥æ•°":3},{"éƒ½é“åºœçœŒ":"å³¶æ ¹çœŒ","å…¨ä¼æ¥­æ•°":1565,"SFå°å…¥ä¼æ¥­æ•°":41,"å‰µæ¥­è€…ãƒ•ãƒ©ã‚°ä¼æ¥­æ•°":93,"SFå°å…¥ç‡(%)":2.62,"ãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒšãƒ¼ã‚¹æ•°":1524,"L1 Sales_å°å…¥æ•°":13,"L1 Service_å°å…¥æ•°":6,"L1 Slack_å°å…¥æ•°":3,"L1 AI and Data_å°å…¥æ•°":0,"L1 Analytics_å°å…¥æ•°":8,"L1 Integration_å°å…¥æ•°":0},{"éƒ½é“åºœçœŒ":"å’Œæ­Œå±±çœŒ","å…¨ä¼æ¥­æ•°":1984,"SFå°å…¥ä¼æ¥­æ•°":47,"å‰µæ¥­è€…ãƒ•ãƒ©ã‚°ä¼æ¥­æ•°":131,"SFå°å…¥ç‡(%)":2.37,"ãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒšãƒ¼ã‚¹æ•°":1937,"L1 Sales_å°å…¥æ•°":20,"L1 Service_å°å…¥æ•°":12,"L1 Slack_å°å…¥æ•°":6,"L1 AI and Data_å°å…¥æ•°":0,"L1 Analytics_å°å…¥æ•°":12,"L1 Integration_å°å…¥æ•°":0},{"éƒ½é“åºœçœŒ":"ç¦å³¶çœŒ","å…¨ä¼æ¥­æ•°":3875,"SFå°å…¥ä¼æ¥­æ•°":92,"å‰µæ¥­è€…ãƒ•ãƒ©ã‚°ä¼æ¥­æ•°":421,"SFå°å…¥ç‡(%)":2.37,"ãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒšãƒ¼ã‚¹æ•°":3783,"L1 Sales_å°å…¥æ•°":25,"L1 Service_å°å…¥æ•°":14,"L1 Slack_å°å…¥æ•°":13,"L1 AI and Data_å°å…¥æ•°":1,"L1 Analytics_å°å…¥æ•°":14,"L1 Integration_å°å…¥æ•°":0},{"éƒ½é“åºœçœŒ":"å¥ˆè‰¯çœŒ","å…¨ä¼æ¥­æ•°":1999,"SFå°å…¥ä¼æ¥­æ•°":45,"å‰µæ¥­è€…ãƒ•ãƒ©ã‚°ä¼æ¥­æ•°":160,"SFå°å…¥ç‡(%)":2.25,"ãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒšãƒ¼ã‚¹æ•°":1954,"L1 Sales_å°å…¥æ•°":21,"L1 Service_å°å…¥æ•°":10,"L1 Slack_å°å…¥æ•°":6,"L1 AI and Data_å°å…¥æ•°":0,"L1 Analytics_å°å…¥æ•°":12,"L1 Integration_å°å…¥æ•°":0},{"éƒ½é“åºœçœŒ":"å¾³å³¶çœŒ","å…¨ä¼æ¥­æ•°":1789,"SFå°å…¥ä¼æ¥­æ•°":40,"å‰µæ¥­è€…ãƒ•ãƒ©ã‚°ä¼æ¥­æ•°":115,"SFå°å…¥ç‡(%)":2.24,"ãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒšãƒ¼ã‚¹æ•°":1749,"L1 Sales_å°å…¥æ•°":9,"L1 Service_å°å…¥æ•°":4,"L1 Slack_å°å…¥æ•°":8,"L1 AI and Data_å°å…¥æ•°":0,"L1 Analytics_å°å…¥æ•°":8,"L1 Integration_å°å…¥æ•°":0},{"éƒ½é“åºœçœŒ":"èŒ¨åŸçœŒ","å…¨ä¼æ¥­æ•°":5051,"SFå°å…¥ä¼æ¥­æ•°":106,"å‰µæ¥­è€…ãƒ•ãƒ©ã‚°ä¼æ¥­æ•°":433,"SFå°å…¥ç‡(%)":2.1,"ãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒšãƒ¼ã‚¹æ•°":4945,"L1 Sales_å°å…¥æ•°":37,"L1 Service_å°å…¥æ•°":16,"L1 Slack_å°å…¥æ•°":20,"L1 AI and Data_å°å…¥æ•°":1,"L1 Analytics_å°å…¥æ•°":23,"L1 Integration_å°å…¥æ•°":0},{"éƒ½é“åºœçœŒ":"å²©æ‰‹çœŒ","å…¨ä¼æ¥­æ•°":2538,"SFå°å…¥ä¼æ¥­æ•°":51,"å‰µæ¥­è€…ãƒ•ãƒ©ã‚°ä¼æ¥­æ•°":235,"SFå°å…¥ç‡(%)":2.01,"ãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒšãƒ¼ã‚¹æ•°":2487,"L1 Sales_å°å…¥æ•°":22,"L1 Service_å°å…¥æ•°":8,"L1 Slack_å°å…¥æ•°":14,"L1 AI and Data_å°å…¥æ•°":0,"L1 Analytics_å°å…¥æ•°":9,"L1 Integration_å°å…¥æ•°":0},{"éƒ½é“åºœçœŒ":"é’æ£®çœŒ","å…¨ä¼æ¥­æ•°":3078,"SFå°å…¥ä¼æ¥­æ•°":57,"å‰µæ¥­è€…ãƒ•ãƒ©ã‚°ä¼æ¥­æ•°":304,"SFå°å…¥ç‡(%)":1.85,"ãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒšãƒ¼ã‚¹æ•°":3021,"L1 Sales_å°å…¥æ•°":15,"L1 Service_å°å…¥æ•°":8,"L1 Slack_å°å…¥æ•°":10,"L1 AI and Data_å°å…¥æ•°":0,"L1 Analytics_å°å…¥æ•°":8,"L1 Integration_å°å…¥æ•°":0},{"éƒ½é“åºœçœŒ":"å®®å´çœŒ","å…¨ä¼æ¥­æ•°":2498,"SFå°å…¥ä¼æ¥­æ•°":42,"å‰µæ¥­è€…ãƒ•ãƒ©ã‚°ä¼æ¥­æ•°":200,"SFå°å…¥ç‡(%)":1.68,"ãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒšãƒ¼ã‚¹æ•°":2456,"L1 Sales_å°å…¥æ•°":13,"L1 Service_å°å…¥æ•°":5,"L1 Slack_å°å…¥æ•°":3,"L1 AI and Data_å°å…¥æ•°":2,"L1 Analytics_å°å…¥æ•°":8,"L1 Integration_å°å…¥æ•°":0},{"éƒ½é“åºœçœŒ":"ç§‹ç”°çœŒ","å…¨ä¼æ¥­æ•°":2257,"SFå°å…¥ä¼æ¥­æ•°":35,"å‰µæ¥­è€…ãƒ•ãƒ©ã‚°ä¼æ¥­æ•°":165,"SFå°å…¥ç‡(%)":1.55,"ãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒšãƒ¼ã‚¹æ•°":2222,"L1 Sales_å°å…¥æ•°":7,"L1 Service_å°å…¥æ•°":7,"L1 Slack_å°å…¥æ•°":7,"L1 AI and Data_å°å…¥æ•°":2,"L1 Analytics_å°å…¥æ•°":8,"L1 Integration_å°å…¥æ•°":0}];

// ============================================================
// CONFIG
// ============================================================
const PRODUCTS = ["L1 Sales","L1 Service","L1 Slack","L1 AI and Data","L1 Analytics","L1 Integration"];
const PRODUCT_COLORS = {
  "L1 Sales":"#0176d3","L1 Service":"#2ecc71","L1 Slack":"#7c5cbf",
  "L1 AI and Data":"#ff6b35","L1 Analytics":"#f1c40f","L1 Integration":"#e74c3c"
};
const PRODUCT_LABELS = {
  "L1 Sales":"Sales","L1 Service":"Service","L1 Slack":"Slack",
  "L1 AI and Data":"AI & Data","L1 Analytics":"Analytics","L1 Integration":"Integration"
};
const REGIONS = {
  "åŒ—æµ·é“ãƒ»æ±åŒ—": ["åŒ—æµ·é“","é’æ£®çœŒ","å²©æ‰‹çœŒ","å®®åŸçœŒ","ç§‹ç”°çœŒ","å±±å½¢çœŒ","ç¦å³¶çœŒ"],
  "é–¢æ±":         ["èŒ¨åŸçœŒ","æ ƒæœ¨çœŒ","ç¾¤é¦¬çœŒ","åŸ¼ç‰çœŒ","åƒè‘‰çœŒ","æ±äº¬éƒ½","ç¥å¥ˆå·çœŒ"],
  "ä¸­éƒ¨":         ["æ–°æ½ŸçœŒ","å¯Œå±±çœŒ","çŸ³å·çœŒ","ç¦äº•çœŒ","å±±æ¢¨çœŒ","é•·é‡çœŒ","å²é˜œçœŒ","é™å²¡çœŒ","æ„›çŸ¥çœŒ"],
  "è¿‘ç•¿":         ["ä¸‰é‡çœŒ","æ»‹è³€çœŒ","äº¬éƒ½åºœ","å¤§é˜ªåºœ","å…µåº«çœŒ","å¥ˆè‰¯çœŒ","å’Œæ­Œå±±çœŒ"],
  "ä¸­å›½":         ["é³¥å–çœŒ","å³¶æ ¹çœŒ","å²¡å±±çœŒ","åºƒå³¶çœŒ","å±±å£çœŒ"],
  "å››å›½":         ["å¾³å³¶çœŒ","é¦™å·çœŒ","æ„›åª›çœŒ","é«˜çŸ¥çœŒ"],
  "ä¹å·ãƒ»æ²–ç¸„":   ["ç¦å²¡çœŒ","ä½è³€çœŒ","é•·å´çœŒ","ç†Šæœ¬çœŒ","å¤§åˆ†çœŒ","å®®å´çœŒ","é¹¿å…å³¶çœŒ","æ²–ç¸„çœŒ"],
};
const REGION_COLORS = {
  "åŒ—æµ·é“ãƒ»æ±åŒ—":"#6c8ebf","é–¢æ±":"#0176d3","ä¸­éƒ¨":"#2ecc71",
  "è¿‘ç•¿":"#9b59b6","ä¸­å›½":"#f1c40f","å››å›½":"#e67e22","ä¹å·ãƒ»æ²–ç¸„":"#e74c3c"
};

// ============================================================
// STATE
// ============================================================
let compareMode = false;

// é€šå¸¸ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
let state = {
  region: "ALL", pref: "ALL",
  products: new Set(PRODUCTS), sort: "rate_desc",
  aov: new Set(),      // ç©º=å…¨ã¦
  founder: false,
};

// æ¯”è¼ƒãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ A/B
let stateA = { region:"ALL", pref:"ALL", products: new Set(PRODUCTS) };
let stateB = { region:"é–¢æ±", pref:"ALL", products: new Set(PRODUCTS) };

function hexToRgb(hex){
  const h=hex.replace('#','');
  return [parseInt(h.slice(0,2),16),parseInt(h.slice(2,4),16),parseInt(h.slice(4,6),16)];
}

// ============================================================
// FILTER LOGIC
// ============================================================
function applyFilter(st, sourceData) {
  let data = sourceData || prefData;
  if (st.region !== "ALL") data = data.filter(d => REGIONS[st.region]?.includes(d['éƒ½é“åºœçœŒ']));
  if (st.pref   !== "ALL") data = data.filter(d => d['éƒ½é“åºœçœŒ'] === st.pref);
  return data;
}

function getFiltered() {
  let data = applyFilter(state);
  // å‰µæ¥­è€…ãƒ•ãƒ©ã‚°ONæ™‚: å…¨ä¼æ¥­æ•°ãƒ»SFæ•°ãƒ»WSæ•°ã‚’å‰µæ¥­è€…ãƒ•ãƒ©ã‚°ä¼æ¥­æ•°ãƒ™ãƒ¼ã‚¹ã«åˆ‡ã‚Šæ›¿ãˆ
  // (prefDataã«ã¯å‰µæ¥­è€…ãƒ•ãƒ©ã‚°ä¼æ¥­æ•°ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã®ã§ã€founderãƒ¢ãƒ¼ãƒ‰ã§ã¯è¡¨ç¤ºã‚’å·®ã—æ›¿ãˆã‚‹)
  data = [...data].sort((a,b)=>{
    const sf=state.sort;
    if(sf==='rate_desc') return b['SFå°å…¥ç‡(%)']-a['SFå°å…¥ç‡(%)'];
    if(sf==='rate_asc')  return a['SFå°å…¥ç‡(%)']-b['SFå°å…¥ç‡(%)'];
    if(sf==='sf_desc')   return b['SFå°å…¥ä¼æ¥­æ•°']-a['SFå°å…¥ä¼æ¥­æ•°'];
    if(sf==='ws_desc')   return b['ãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒšãƒ¼ã‚¹æ•°']-a['ãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒšãƒ¼ã‚¹æ•°'];
    if(sf==='total_desc')return b['å…¨ä¼æ¥­æ•°']-a['å…¨ä¼æ¥­æ•°'];
    return 0;
  });
  return data;
}

function getProductCount(d, product) { return d[product + '_å°å…¥æ•°'] || 0; }

function stateLabel(st) {
  if(st.pref !== 'ALL') return st.pref;
  if(st.region !== 'ALL') return st.region;
  return 'å…¨å›½';
}

// ============================================================
// CHARTS
// ============================================================
let charts = {};
function destroyChart(id) { if(charts[id]){ charts[id].destroy(); delete charts[id]; } }

Chart.defaults.color = '#8892b0';
Chart.defaults.borderColor = '#2e3350';
Chart.defaults.font.family = "'Segoe UI','Hiragino Sans',sans-serif";

// ============================================================
// KPI RENDER
// ============================================================
function renderKPI(filtered) {
  if(compareMode) {
    const fA = applyFilter(stateA); const fB = applyFilter(stateB);
    const tA=fA.reduce((s,d)=>s+d['å…¨ä¼æ¥­æ•°'],0);       const tB=fB.reduce((s,d)=>s+d['å…¨ä¼æ¥­æ•°'],0);
    const sfA=fA.reduce((s,d)=>s+d['SFå°å…¥ä¼æ¥­æ•°'],0);  const sfB=fB.reduce((s,d)=>s+d['SFå°å…¥ä¼æ¥­æ•°'],0);
    const wsA=fA.reduce((s,d)=>s+d['ãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒšãƒ¼ã‚¹æ•°'],0); const wsB=fB.reduce((s,d)=>s+d['ãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒšãƒ¼ã‚¹æ•°'],0);
    const rA=tA>0?(sfA/tA*100).toFixed(2):0; const rB=tB>0?(sfB/tB*100).toFixed(2):0;

    function cmpKpi(wrapId, aVal, bVal, fmt, diffLabel) {
      const wrap = document.getElementById(wrapId);
      wrap.innerHTML = `<div class="kpi-cmp">
        <div class="kpi-cmp-row"><span class="kpi-cmp-val" style="color:var(--cmp-a)">${fmt(aVal)}</span><span class="kpi-cmp-tag a">A: ${stateLabel(stateA)}</span></div>
        <div class="kpi-cmp-row"><span class="kpi-cmp-val" style="color:var(--cmp-b)">${fmt(bVal)}</span><span class="kpi-cmp-tag b">B: ${stateLabel(stateB)}</span></div>
        <div class="kpi-cmp-diff">${diffLabel(aVal,bVal)}</div>
      </div>`;
    }
    cmpKpi('kpi-total-wrap', tA, tB, v=>Number(v).toLocaleString(), (a,b)=>`å·®: ${Math.abs(a-b).toLocaleString()}ç¤¾`);
    cmpKpi('kpi-sf-wrap', sfA, sfB, v=>Number(v).toLocaleString(), (a,b)=>`å·®: ${Math.abs(a-b).toLocaleString()}ç¤¾`);
    cmpKpi('kpi-ws-wrap', wsA, wsB, v=>Number(v).toLocaleString(), (a,b)=>`å·®: ${Math.abs(a-b).toLocaleString()}ç¤¾`);
    cmpKpi('kpi-rate-wrap', rA, rB, v=>v+'%', (a,b)=>`å·®: ${Math.abs(Number(a)-Number(b)).toFixed(2)}pt`);
    document.getElementById('headerBadge').textContent = 'æ¯”è¼ƒãƒ¢ãƒ¼ãƒ‰';
  } else {
    const totalComp = filtered.reduce((s,d)=>s+d['å…¨ä¼æ¥­æ•°'],0);
    const totalSF   = filtered.reduce((s,d)=>s+d['SFå°å…¥ä¼æ¥­æ•°'],0);
    const totalWS   = filtered.reduce((s,d)=>s+d['ãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒšãƒ¼ã‚¹æ•°'],0);
    const avgRate   = totalComp>0 ? (totalSF/totalComp*100).toFixed(2) : 0;
    document.getElementById('kpi-total-wrap').innerHTML=`<div class="kpi-value" style="color:#0176d3" id="kpi-total">${totalComp.toLocaleString()}</div><div class="kpi-sub">å¯¾è±¡ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼å†…</div>`;
    document.getElementById('kpi-sf-wrap').innerHTML=`<div class="kpi-value" style="color:#00a1e0" id="kpi-sf">${totalSF.toLocaleString()}</div><div class="kpi-sub" id="kpi-sf-sub">å…¨ä½“ã® ${avgRate}%</div>`;
    document.getElementById('kpi-ws-wrap').innerHTML=`<div class="kpi-value" style="color:#ff6b35" id="kpi-ws">${totalWS.toLocaleString()}</div><div class="kpi-sub" id="kpi-ws-sub">SFæœªå°å…¥ã®æ½œåœ¨é¡§å®¢</div>`;
    document.getElementById('kpi-rate-wrap').innerHTML=`<div class="kpi-value" style="color:#7c5cbf" id="kpi-rate">${avgRate}%</div><div class="kpi-sub" id="kpi-rate-sub">${filtered.length}éƒ½é“åºœçœŒã®å¹³å‡</div>`;
    document.getElementById('headerBadge').textContent = totalComp.toLocaleString() + 'ç¤¾åˆ†æ';
  }
}

// ============================================================
// RENDER ALL CHARTS
// ============================================================
function renderAll() {
  const filtered = getFiltered();

  renderKPI(filtered);

  const top20 = filtered.slice(0, 20);
  const top15 = filtered.slice(0, 15);

  const filterHint = state.region!=='ALL' ? `â–¸ ${state.region}` : state.pref!=='ALL' ? `â–¸ ${state.pref}` : '';
  document.getElementById('prefRateHint').textContent = compareMode ? '' : filterHint;
  document.getElementById('tableHint').textContent    = compareMode ? '' : filterHint;
  document.getElementById('stackedHint').textContent  = compareMode ? '' : filterHint;
  document.getElementById('countHint').textContent    = compareMode ? '' : filterHint;

  // --- compare strip ---
  const strip = document.getElementById('compareStrip');
  if(compareMode){
    strip.classList.add('visible');
    document.getElementById('cstripA').textContent = 'A: ' + stateLabel(stateA);
    document.getElementById('cstripB').textContent = 'B: ' + stateLabel(stateB);
  } else {
    strip.classList.remove('visible');
  }

  // ======= CHART 1: éƒ½é“åºœçœŒåˆ¥ SFå°å…¥ç‡ =======
  destroyChart('prefRate');
  if(compareMode) {
    const fA = applyFilter(stateA).sort((a,b)=>b['SFå°å…¥ç‡(%)']-a['SFå°å…¥ç‡(%)']).slice(0,15);
    const fB = applyFilter(stateB).sort((a,b)=>b['SFå°å…¥ç‡(%)']-a['SFå°å…¥ç‡(%)']).slice(0,15);
    // ã™ã¹ã¦ã®ãƒ©ãƒ™ãƒ«ã‚’ãƒãƒ¼ã‚¸ (Aå„ªå…ˆ)
    const allPrefs = [...new Set([...fA.map(d=>d['éƒ½é“åºœçœŒ']), ...fB.map(d=>d['éƒ½é“åºœçœŒ'])])].slice(0,15);
    const mapA = Object.fromEntries(fA.map(d=>[d['éƒ½é“åºœçœŒ'],d['SFå°å…¥ç‡(%)']]));
    const mapB = Object.fromEntries(fB.map(d=>[d['éƒ½é“åºœçœŒ'],d['SFå°å…¥ç‡(%)']]));
    charts['prefRate'] = new Chart(document.getElementById('prefRateChart'), {
      type:'bar',
      data:{
        labels: allPrefs,
        datasets:[
          {label:`A: ${stateLabel(stateA)}`, data:allPrefs.map(p=>mapA[p]||0), backgroundColor:'rgba(0,161,224,0.8)', borderRadius:4, borderSkipped:false},
          {label:`B: ${stateLabel(stateB)}`, data:allPrefs.map(p=>mapB[p]||0), backgroundColor:'rgba(255,107,53,0.75)', borderRadius:4, borderSkipped:false},
        ]
      },
      options:{
        indexAxis:'y',responsive:true,maintainAspectRatio:false,
        plugins:{legend:{position:'top',labels:{padding:10,boxWidth:10}},
          tooltip:{callbacks:{label:ctx=>` ${ctx.dataset.label}: ${ctx.raw}%`}}},
        scales:{x:{grid:{color:'rgba(255,255,255,0.04)'},ticks:{callback:v=>v+'%'}},y:{grid:{display:false},ticks:{font:{size:11}}}}
      }
    });
  } else {
    charts['prefRate'] = new Chart(document.getElementById('prefRateChart'), {
      type: 'bar',
      data: {
        labels: top20.map(d=>d['éƒ½é“åºœçœŒ']),
        datasets: [{
          label: 'SFå°å…¥ç‡(%)',
          data: top20.map(d=>d['SFå°å…¥ç‡(%)']),
          backgroundColor: top20.map(d=>{
            const r=d['SFå°å…¥ç‡(%)'];
            if(r>20) return 'rgba(1,118,211,0.92)';
            if(r>8)  return 'rgba(0,161,224,0.85)';
            if(r>5)  return 'rgba(46,204,113,0.8)';
            return 'rgba(100,120,180,0.7)';
          }),
          borderRadius:6, borderSkipped:false,
        }]
      },
      options:{
        indexAxis:'y', responsive:true, maintainAspectRatio:false,
        plugins:{legend:{display:false},
          tooltip:{callbacks:{label:ctx=>{
            const d=top20[ctx.dataIndex];
            return [` SFå°å…¥ç‡: ${ctx.raw}%`,` SFä¼æ¥­æ•°: ${d['SFå°å…¥ä¼æ¥­æ•°'].toLocaleString()}ç¤¾`,` ãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒšãƒ¼ã‚¹: ${d['ãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒšãƒ¼ã‚¹æ•°'].toLocaleString()}ç¤¾`];
          }}}},
        scales:{x:{grid:{color:'rgba(255,255,255,0.04)'},ticks:{callback:v=>v+'%'}},y:{grid:{display:false},ticks:{font:{size:11}}}}
      }
    });
  }

  // ======= CHART 2: ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã‚«ãƒ¼ãƒ‰ + ãƒ‰ãƒ¼ãƒŠãƒ„ =======
  const activeProd = [...state.products];
  const productCardEl = document.getElementById('productCards');
  productCardEl.innerHTML = '';
  if(compareMode){
    const fA = applyFilter(stateA); const fB = applyFilter(stateB);
    const sfA = fA.reduce((s,d)=>s+d['SFå°å…¥ä¼æ¥­æ•°'],0);
    const sfB = fB.reduce((s,d)=>s+d['SFå°å…¥ä¼æ¥­æ•°'],0);
    PRODUCTS.forEach(p=>{
      const cA=fA.reduce((s,d)=>s+getProductCount(d,p),0);
      const cB=fB.reduce((s,d)=>s+getProductCount(d,p),0);
      const card = document.createElement('div');
      card.className='product-card'; card.style.setProperty('--p-color', PRODUCT_COLORS[p]);
      card.innerHTML=`<div class="product-name">${PRODUCT_LABELS[p]}</div>
        <div class="product-cmp-a" style="font-size:16px;font-weight:800;">${cA.toLocaleString()}</div>
        <div class="product-card-cmp">
          <span class="product-cmp-a">A ${sfA>0?(cA/sfA*100).toFixed(1):0}%</span>
          <span style="margin:0 4px;color:var(--muted)">vs</span>
          <span class="product-cmp-b">B ${sfB>0?(cB/sfB*100).toFixed(1):0}%</span>
        </div>`;
      productCardEl.appendChild(card);
    });
    // donut: compare A vs B per product (side by side via grouped bar instead)
    destroyChart('donut');
    charts['donut'] = new Chart(document.getElementById('productDonut'),{
      type:'bar',
      data:{
        labels: PRODUCTS.map(p=>PRODUCT_LABELS[p]),
        datasets:[
          {label:`A: ${stateLabel(stateA)}`, data:PRODUCTS.map(p=>fA.reduce((s,d)=>s+getProductCount(d,p),0)), backgroundColor:'rgba(0,161,224,0.8)', borderRadius:4, borderSkipped:false},
          {label:`B: ${stateLabel(stateB)}`, data:PRODUCTS.map(p=>fB.reduce((s,d)=>s+getProductCount(d,p),0)), backgroundColor:'rgba(255,107,53,0.75)', borderRadius:4, borderSkipped:false},
        ]
      },
      options:{
        responsive:true, maintainAspectRatio:false,
        plugins:{legend:{position:'top',labels:{padding:10,boxWidth:10}}},
        scales:{x:{grid:{display:false},ticks:{font:{size:10}}},y:{grid:{color:'rgba(255,255,255,0.04)'},ticks:{callback:v=>v>=1000?(v/1000).toFixed(0)+'k':v}}}
      }
    });
  } else {
    const totalSF = filtered.reduce((s,d)=>s+d['SFå°å…¥ä¼æ¥­æ•°'],0);
    activeProd.forEach(p=>{
      const cnt = filtered.reduce((s,d)=>s+getProductCount(d,p),0);
      const share = totalSF>0?(cnt/totalSF*100).toFixed(1):0;
      const card = document.createElement('div');
      card.className = 'product-card'; card.style.setProperty('--p-color', PRODUCT_COLORS[p]);
      card.innerHTML=`<div class="product-name">${PRODUCT_LABELS[p]}</div><div class="product-count" style="color:${PRODUCT_COLORS[p]}">${cnt.toLocaleString()}</div><div class="product-share">SFä¼æ¥­å†… ${share}%</div>`;
      productCardEl.appendChild(card);
    });
    destroyChart('donut');
    charts['donut'] = new Chart(document.getElementById('productDonut'),{
      type:'doughnut',
      data:{
        labels: activeProd.map(p=>PRODUCT_LABELS[p]),
        datasets:[{
          data: activeProd.map(p=>filtered.reduce((s,d)=>s+getProductCount(d,p),0)),
          backgroundColor: activeProd.map(p=>PRODUCT_COLORS[p]),
          borderWidth:2, borderColor:'#1a1d27', hoverOffset:8,
        }]
      },
      options:{
        responsive:true, maintainAspectRatio:false, cutout:'65%',
        plugins:{
          legend:{position:'right',labels:{padding:10,font:{size:10}}},
          tooltip:{callbacks:{label:ctx=>{const totalSF2=filtered.reduce((s,d)=>s+d['SFå°å…¥ä¼æ¥­æ•°'],0); return ` ${ctx.label}: ${ctx.raw.toLocaleString()}ç¤¾ (${totalSF2>0?(ctx.raw/totalSF2*100).toFixed(1):0}%)`;} }}
        }
      }
    });
  }

  // ======= CHART 3: ãƒ†ãƒ¼ãƒ–ãƒ« =======
  const maxRate = filtered.length>0?filtered.reduce((m,d)=>Math.max(m,d['SFå°å…¥ç‡(%)']),0):1;
  document.getElementById('tableHead').innerHTML=`<tr>
    <th>#</th><th>éƒ½é“åºœçœŒ</th><th>å°å…¥ç‡</th><th>SFä¼æ¥­æ•°</th><th>å…¨ä¼æ¥­æ•°</th><th>ãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒšãƒ¼ã‚¹</th>
    ${compareMode?'<th>A å°å…¥ç‡</th><th>B å°å…¥ç‡</th>':''}
  </tr>`;
  const tbody = document.getElementById('tableBody');
  tbody.innerHTML='';

  if(compareMode) {
    const fA = applyFilter(stateA); const fB = applyFilter(stateB);
    const mapA2 = Object.fromEntries(fA.map(d=>[d['éƒ½é“åºœçœŒ'],d]));
    const mapB2 = Object.fromEntries(fB.map(d=>[d['éƒ½é“åºœçœŒ'],d]));
    const allPrefs2 = prefData.map(d=>d['éƒ½é“åºœçœŒ']).filter(p=> mapA2[p]||mapB2[p]);
    allPrefs2.forEach((pref,i)=>{
      const dA=mapA2[pref]; const dB=mapB2[pref];
      const dBase = dA||dB;
      const barW = maxRate>0?Math.round(dBase['SFå°å…¥ç‡(%)']/maxRate*100):0;
      const rA = dA ? dA['SFå°å…¥ç‡(%)']+'%' : 'â€”';
      const rB = dB ? dB['SFå°å…¥ç‡(%)']+'%' : 'â€”';
      const tr=document.createElement('tr');
      tr.innerHTML=`<td class="rank">${i+1}</td><td class="pref-name">${pref}</td>
        <td><div class="rate-bar-wrap"><div class="rate-bar" style="width:${barW}px"></div><span class="rate-val">${dBase['SFå°å…¥ç‡(%)']}%</span></div></td>
        <td>${dBase['SFå°å…¥ä¼æ¥­æ•°'].toLocaleString()}</td><td>${dBase['å…¨ä¼æ¥­æ•°'].toLocaleString()}</td>
        <td><span class="ws-badge">${dBase['ãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒšãƒ¼ã‚¹æ•°'].toLocaleString()}</span></td>
        <td style="color:var(--cmp-a);font-weight:700">${rA}</td>
        <td style="color:var(--cmp-b);font-weight:700">${rB}</td>`;
      tbody.appendChild(tr);
    });
  } else {
    filtered.forEach((d,i)=>{
      const barW = maxRate>0?Math.round(d['SFå°å…¥ç‡(%)']/maxRate*100):0;
      const tr=document.createElement('tr');
      tr.innerHTML=`<td class="rank">${i+1}</td><td class="pref-name">${d['éƒ½é“åºœçœŒ']}</td>
        <td><div class="rate-bar-wrap"><div class="rate-bar" style="width:${barW}px"></div><span class="rate-val">${d['SFå°å…¥ç‡(%)']}%</span></div></td>
        <td>${d['SFå°å…¥ä¼æ¥­æ•°'].toLocaleString()}</td><td>${d['å…¨ä¼æ¥­æ•°'].toLocaleString()}</td>
        <td><span class="ws-badge">${d['ãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒšãƒ¼ã‚¹æ•°'].toLocaleString()}</span></td>`;
      tbody.appendChild(tr);
    });
  }

  // ======= CHART 4: ç©ã¿ä¸Šã’æ£’ SF vs WS =======
  destroyChart('stacked');
  if(compareMode){
    const fA=applyFilter(stateA).sort((a,b)=>b['å…¨ä¼æ¥­æ•°']-a['å…¨ä¼æ¥­æ•°']).slice(0,10);
    const fB=applyFilter(stateB).sort((a,b)=>b['å…¨ä¼æ¥­æ•°']-a['å…¨ä¼æ¥­æ•°']).slice(0,10);
    const allP3=[...new Set([...fA.map(d=>d['éƒ½é“åºœçœŒ']),...fB.map(d=>d['éƒ½é“åºœçœŒ'])])].slice(0,10);
    const mA3=Object.fromEntries(fA.map(d=>[d['éƒ½é“åºœçœŒ'],d]));
    const mB3=Object.fromEntries(fB.map(d=>[d['éƒ½é“åºœçœŒ'],d]));
    charts['stacked']=new Chart(document.getElementById('stackedBar'),{
      type:'bar',
      data:{
        labels:allP3,
        datasets:[
          {label:`A SFå°å…¥`,data:allP3.map(p=>mA3[p]?mA3[p]['SFå°å…¥ä¼æ¥­æ•°']:0),backgroundColor:'rgba(0,161,224,0.85)',borderRadius:0},
          {label:`A WS`,data:allP3.map(p=>mA3[p]?mA3[p]['ãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒšãƒ¼ã‚¹æ•°']:0),backgroundColor:'rgba(0,161,224,0.25)',borderRadius:0},
          {label:`B SFå°å…¥`,data:allP3.map(p=>mB3[p]?mB3[p]['SFå°å…¥ä¼æ¥­æ•°']:0),backgroundColor:'rgba(255,107,53,0.85)',borderRadius:0},
          {label:`B WS`,data:allP3.map(p=>mB3[p]?mB3[p]['ãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒšãƒ¼ã‚¹æ•°']:0),backgroundColor:'rgba(255,107,53,0.25)',borderRadius:0},
        ]
      },
      options:{responsive:true,maintainAspectRatio:false,
        plugins:{legend:{position:'top',labels:{padding:10,boxWidth:10}}},
        scales:{x:{grid:{display:false},ticks:{font:{size:10}}},y:{grid:{color:'rgba(255,255,255,0.04)'},ticks:{callback:v=>v>=1000?(v/1000).toFixed(0)+'k':v}}}
      }
    });
  } else {
    charts['stacked']=new Chart(document.getElementById('stackedBar'),{
      type:'bar',
      data:{
        labels:top15.map(d=>d['éƒ½é“åºœçœŒ']),
        datasets:[
          {label:'SFå°å…¥ä¼æ¥­',data:top15.map(d=>d['SFå°å…¥ä¼æ¥­æ•°']),backgroundColor:'rgba(0,161,224,0.85)',borderRadius:0},
          {label:'ãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒšãƒ¼ã‚¹',data:top15.map(d=>d['ãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒšãƒ¼ã‚¹æ•°']),backgroundColor:'rgba(255,107,53,0.35)',borderRadius:0},
        ]
      },
      options:{responsive:true,maintainAspectRatio:false,
        plugins:{legend:{position:'top',labels:{padding:14,boxWidth:10}},
          tooltip:{mode:'index',callbacks:{afterBody:items=>{const d=top15[items[0].dataIndex];return [`å°å…¥ç‡: ${d['SFå°å…¥ç‡(%)']}%`];}}}},
        scales:{x:{stacked:true,grid:{display:false},ticks:{font:{size:10}}},y:{stacked:true,grid:{color:'rgba(255,255,255,0.04)'},ticks:{callback:v=>v>=1000?(v/1000).toFixed(0)+'k':v}}}
      }
    });
  }

  // ======= CHART 5: ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆåˆ¥ SFä¼æ¥­æ•° =======
  destroyChart('sfCount');
  if(compareMode){
    const fA=applyFilter(stateA).sort((a,b)=>b['SFå°å…¥ä¼æ¥­æ•°']-a['SFå°å…¥ä¼æ¥­æ•°']).slice(0,10);
    const fB=applyFilter(stateB).sort((a,b)=>b['SFå°å…¥ä¼æ¥­æ•°']-a['SFå°å…¥ä¼æ¥­æ•°']).slice(0,10);
    const allP5=[...new Set([...fA.map(d=>d['éƒ½é“åºœçœŒ']),...fB.map(d=>d['éƒ½é“åºœçœŒ'])])].slice(0,10);
    const mA5=Object.fromEntries(fA.map(d=>[d['éƒ½é“åºœçœŒ'],d]));
    const mB5=Object.fromEntries(fB.map(d=>[d['éƒ½é“åºœçœŒ'],d]));
    charts['sfCount']=new Chart(document.getElementById('sfCountChart'),{
      type:'bar',
      data:{
        labels:allP5,
        datasets:[
          {label:`A: ${stateLabel(stateA)} SFæ•°`,data:allP5.map(p=>mA5[p]?mA5[p]['SFå°å…¥ä¼æ¥­æ•°']:0),backgroundColor:'rgba(0,161,224,0.85)',borderRadius:4,borderSkipped:false},
          {label:`B: ${stateLabel(stateB)} SFæ•°`,data:allP5.map(p=>mB5[p]?mB5[p]['SFå°å…¥ä¼æ¥­æ•°']:0),backgroundColor:'rgba(255,107,53,0.75)',borderRadius:4,borderSkipped:false},
        ]
      },
      options:{responsive:true,maintainAspectRatio:false,
        plugins:{legend:{position:'top',labels:{padding:10,boxWidth:10}}},
        scales:{x:{grid:{display:false},ticks:{font:{size:10}}},y:{grid:{color:'rgba(255,255,255,0.04)'},ticks:{callback:v=>v>=1000?(v/1000).toFixed(0)+'k':v}}}
      }
    });
  } else {
    charts['sfCount']=new Chart(document.getElementById('sfCountChart'),{
      type:'bar',
      data:{
        labels:top15.map(d=>d['éƒ½é“åºœçœŒ']),
        datasets:activeProd.map(p=>{
          const [r,g,b]=hexToRgb(PRODUCT_COLORS[p]);
          return {label:PRODUCT_LABELS[p],data:top15.map(d=>getProductCount(d,p)),backgroundColor:`rgba(${r},${g},${b},0.82)`,borderRadius:0};
        })
      },
      options:{responsive:true,maintainAspectRatio:false,
        plugins:{legend:{position:'bottom',labels:{padding:8,boxWidth:10,font:{size:10}}}},
        scales:{x:{stacked:true,grid:{display:false},ticks:{font:{size:10}}},y:{stacked:true,grid:{color:'rgba(255,255,255,0.04)'},ticks:{callback:v=>v>=1000?(v/1000).toFixed(0)+'k':v}}}
      }
    });
  }

  // ======= CHART 6: æ•£å¸ƒå›³ =======
  destroyChart('scatter');
  if(compareMode){
    const fA=applyFilter(stateA); const fB=applyFilter(stateB);
    charts['scatter']=new Chart(document.getElementById('scatterChart'),{
      type:'scatter',
      data:{datasets:[
        {label:`A: ${stateLabel(stateA)}`,
          data:fA.map(d=>({x:d['SFå°å…¥ç‡(%)'],y:d['ãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒšãƒ¼ã‚¹æ•°'],pref:d['éƒ½é“åºœçœŒ'],sfCount:d['SFå°å…¥ä¼æ¥­æ•°']})),
          backgroundColor:'rgba(0,161,224,0.75)',
          pointRadius:fA.map(d=>Math.max(5,Math.min(22,d['SFå°å…¥ä¼æ¥­æ•°']/200))), pointHoverRadius:10},
        {label:`B: ${stateLabel(stateB)}`,
          data:fB.map(d=>({x:d['SFå°å…¥ç‡(%)'],y:d['ãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒšãƒ¼ã‚¹æ•°'],pref:d['éƒ½é“åºœçœŒ'],sfCount:d['SFå°å…¥ä¼æ¥­æ•°']})),
          backgroundColor:'rgba(255,107,53,0.75)',
          pointRadius:fB.map(d=>Math.max(5,Math.min(22,d['SFå°å…¥ä¼æ¥­æ•°']/200))), pointHoverRadius:10},
      ]},
      options:{responsive:true,maintainAspectRatio:false,
        plugins:{legend:{position:'top',labels:{padding:10,boxWidth:10}},
          tooltip:{callbacks:{label:ctx=>{const d=ctx.raw;return [` ${d.pref}`,` SFå°å…¥ç‡: ${d.x}%`,` ãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒšãƒ¼ã‚¹: ${d.y.toLocaleString()}ç¤¾`];}}}},
        scales:{x:{title:{display:true,text:'SFå°å…¥ç‡(%)'},grid:{color:'rgba(255,255,255,0.04)'},ticks:{callback:v=>v+'%'}},y:{title:{display:true,text:'ãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒšãƒ¼ã‚¹æ•°ï¼ˆç¤¾ï¼‰'},grid:{color:'rgba(255,255,255,0.04)'},ticks:{callback:v=>v>=1000?(v/1000).toFixed(0)+'k':v}}}
      }
    });
  } else {
    charts['scatter']=new Chart(document.getElementById('scatterChart'),{
      type:'scatter',
      data:{datasets:[{
        label:'éƒ½é“åºœçœŒ',
        data:filtered.map(d=>({x:d['SFå°å…¥ç‡(%)'],y:d['ãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒšãƒ¼ã‚¹æ•°'],pref:d['éƒ½é“åºœçœŒ'],sfCount:d['SFå°å…¥ä¼æ¥­æ•°']})),
        backgroundColor:filtered.map(d=>{const r=d['SFå°å…¥ç‡(%)'];if(r>20)return 'rgba(1,118,211,0.88)';if(r>8)return 'rgba(0,161,224,0.82)';if(r>4)return 'rgba(46,204,113,0.78)';return 'rgba(124,92,191,0.72)';}),
        pointRadius:filtered.map(d=>Math.max(5,Math.min(22,d['SFå°å…¥ä¼æ¥­æ•°']/200))), pointHoverRadius:10,
      }]},
      options:{responsive:true,maintainAspectRatio:false,
        plugins:{legend:{display:false},
          tooltip:{callbacks:{label:ctx=>{const d=ctx.raw;return [` ${d.pref}`,` SFå°å…¥ç‡: ${d.x}%`,` ãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒšãƒ¼ã‚¹: ${d.y.toLocaleString()}ç¤¾`,` SFä¼æ¥­æ•°: ${d.sfCount.toLocaleString()}ç¤¾`];}}}},
        scales:{x:{title:{display:true,text:'SFå°å…¥ç‡(%)'},grid:{color:'rgba(255,255,255,0.04)'},ticks:{callback:v=>v+'%'}},y:{title:{display:true,text:'ãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒšãƒ¼ã‚¹æ•°ï¼ˆç¤¾ï¼‰'},grid:{color:'rgba(255,255,255,0.04)'},ticks:{callback:v=>v>=1000?(v/1000).toFixed(0)+'k':v}}}
      }
    });
  }

  // company list re-filter
  if(companiesLoaded) renderCompanyList();
}

// ============================================================
// BUILD NORMAL FILTER UI
// ============================================================
const regionChips = document.getElementById('regionChips');
['ALL',...Object.keys(REGIONS)].forEach(r=>{
  const chip=document.createElement('button');
  chip.className='chip'+(r==='ALL'?' active':'');
  chip.textContent=r==='ALL'?'å…¨å›½':r;
  if(r!=='ALL') chip.style.cssText=`--rc:${REGION_COLORS[r]}`;
  chip.dataset.region=r;
  chip.addEventListener('click',()=>{
    state.region=r; state.pref='ALL';
    document.getElementById('prefSelect').value='ALL';
    updatePrefOptions();
    regionChips.querySelectorAll('.chip').forEach(c=>{c.classList.remove('active');c.style.background='';c.style.borderColor='';c.style.color='';});
    chip.classList.add('active');
    if(r!=='ALL'){const[rv,gv,bv]=hexToRgb(REGION_COLORS[r]);chip.style.background=`rgba(${rv},${gv},${bv},0.85)`;chip.style.borderColor='transparent';chip.style.color='#fff';}
    renderAll();
  });
  regionChips.appendChild(chip);
});

const prefSelect=document.getElementById('prefSelect');
function updatePrefOptions(){
  prefSelect.innerHTML='<option value="ALL">å…¨éƒ½é“åºœçœŒ</option>';
  const list=state.region==='ALL'?prefData.map(d=>d['éƒ½é“åºœçœŒ']):(REGIONS[state.region]||[]);
  list.forEach(p=>{const opt=document.createElement('option');opt.value=p;opt.textContent=p;prefSelect.appendChild(opt);});
  prefSelect.value='ALL';
}
updatePrefOptions();
prefSelect.addEventListener('change',()=>{state.pref=prefSelect.value;renderAll();});

const productChips=document.getElementById('productChips');
PRODUCTS.forEach(p=>{
  const chip=document.createElement('button');
  chip.className='chip active';
  chip.textContent=PRODUCT_LABELS[p];
  const[r,g,b]=hexToRgb(PRODUCT_COLORS[p]);
  chip.style.background=`rgba(${r},${g},${b},0.8)`;chip.style.borderColor='transparent';chip.style.color='#fff';
  chip.dataset.product=p;
  chip.addEventListener('click',()=>{
    if(state.products.has(p)){if(state.products.size===1)return;state.products.delete(p);chip.classList.remove('active');chip.style.background='';chip.style.borderColor='';chip.style.color='';}
    else{state.products.add(p);chip.classList.add('active');chip.style.background=`rgba(${r},${g},${b},0.8)`;chip.style.borderColor='transparent';chip.style.color='#fff';}
    renderAll();
  });
  productChips.appendChild(chip);
});

document.getElementById('sortSelect').addEventListener('change',e=>{state.sort=e.target.value;renderAll();});

document.getElementById('resetBtn').addEventListener('click',()=>{
  state={region:'ALL',pref:'ALL',products:new Set(PRODUCTS),sort:'rate_desc',aov:new Set(),founder:false};
  regionChips.querySelectorAll('.chip').forEach((c,i)=>{c.classList.toggle('active',i===0);c.style.background='';c.style.borderColor='';c.style.color='';});
  productChips.querySelectorAll('.chip').forEach((c,i)=>{
    const p=PRODUCTS[i];const[r,g,b]=hexToRgb(PRODUCT_COLORS[p]);
    c.classList.add('active');c.style.background=`rgba(${r},${g},${b},0.8)`;c.style.borderColor='transparent';c.style.color='#fff';
  });
  // AOVãƒ»å‰µæ¥­è€…ãƒãƒƒãƒ—ãƒªã‚»ãƒƒãƒˆ
  document.querySelectorAll('#globalAovChips .chip').forEach(c=>{c.classList.remove('active');c.style.background='';c.style.borderColor='';c.style.color='';});
  const gfc=document.getElementById('globalFounderChip');
  gfc.classList.remove('active');gfc.style.background='';gfc.style.borderColor='';gfc.style.color='';
  // ä¼æ¥­ä¸€è¦§å´ã‚‚é€£å‹•ãƒªã‚»ãƒƒãƒˆ
  cState.founder=false; cState.aov=new Set();
  const ft=document.getElementById('founderToggle'); if(ft){ft.classList.remove('active');}
  document.querySelectorAll('#aovChips .aov-chip').forEach(c=>c.classList.remove('active'));
  updatePrefOptions();document.getElementById('sortSelect').value='rate_desc';
  renderAll();
});

// ============================================================
// BUILD COMPARE FILTER UI (A and B)
// ============================================================
function buildCmpFilterUI(containerId, prefSelectId, stateRef, label) {
  const rc = document.getElementById(containerId);
  const allRegions = ['ALL',...Object.keys(REGIONS)];
  allRegions.forEach(r=>{
    const chip=document.createElement('button');
    chip.className='chip'+(stateRef.region===r?' active':'');
    chip.textContent=r==='ALL'?'å…¨å›½':r;
    chip.dataset.region=r;
    if(r!=='ALL'&&stateRef.region===r){const[rv,gv,bv]=hexToRgb(REGION_COLORS[r]);chip.style.background=`rgba(${rv},${gv},${bv},0.85)`;chip.style.borderColor='transparent';chip.style.color='#fff';}
    chip.addEventListener('click',()=>{
      stateRef.region=r; stateRef.pref='ALL';
      updateCmpPrefOptions(prefSelectId, stateRef);
      rc.querySelectorAll('.chip').forEach(c=>{c.classList.remove('active');c.style.background='';c.style.borderColor='';c.style.color='';});
      chip.classList.add('active');
      if(r!=='ALL'){const[rv,gv,bv]=hexToRgb(REGION_COLORS[r]);chip.style.background=`rgba(${rv},${gv},${bv},0.85)`;chip.style.borderColor='transparent';chip.style.color='#fff';}
      renderAll();
    });
    rc.appendChild(chip);
  });

  // pref select
  const ps=document.getElementById(prefSelectId);
  updateCmpPrefOptions(prefSelectId, stateRef);
  ps.addEventListener('change',()=>{stateRef.pref=ps.value;renderAll();});
}

function updateCmpPrefOptions(selectId, stateRef){
  const ps=document.getElementById(selectId);
  ps.innerHTML='<option value="ALL">å…¨éƒ½é“åºœçœŒ</option>';
  const list=stateRef.region==='ALL'?prefData.map(d=>d['éƒ½é“åºœçœŒ']):(REGIONS[stateRef.region]||[]);
  list.forEach(p=>{const opt=document.createElement('option');opt.value=p;opt.textContent=p;ps.appendChild(opt);});
  ps.value=stateRef.pref||'ALL';
}

// compare product chips A
function buildCmpProductChips(containerId, stateRef){
  const pc=document.getElementById(containerId);
  PRODUCTS.forEach(p=>{
    const chip=document.createElement('button');
    chip.className='chip active';
    chip.textContent=PRODUCT_LABELS[p];
    const[r,g,b]=hexToRgb(PRODUCT_COLORS[p]);
    chip.style.background=`rgba(${r},${g},${b},0.8)`;chip.style.borderColor='transparent';chip.style.color='#fff';
    chip.addEventListener('click',()=>{
      if(stateRef.products.has(p)){if(stateRef.products.size===1)return;stateRef.products.delete(p);chip.classList.remove('active');chip.style.background='';chip.style.borderColor='';chip.style.color='';}
      else{stateRef.products.add(p);chip.classList.add('active');chip.style.background=`rgba(${r},${g},${b},0.8)`;chip.style.borderColor='transparent';chip.style.color='#fff';}
      renderAll();
    });
    pc.appendChild(chip);
  });
}

buildCmpFilterUI('cmpRegionChipsA','cmpPrefSelectA',stateA,'A');
buildCmpFilterUI('cmpRegionChipsB','cmpPrefSelectB',stateB,'B');
buildCmpProductChips('cmpProductChipsA',stateA);
buildCmpProductChips('cmpProductChipsB',stateB);

// ============================================================
// COMPARE MODE TOGGLE
// ============================================================
const cmpToggleBtn = document.getElementById('cmpToggleBtn');
const normalFilterBar = document.getElementById('normalFilterBar');
const cmpFilterBar = document.getElementById('cmpFilterBar');

cmpToggleBtn.addEventListener('click',()=>{
  compareMode = !compareMode;
  cmpToggleBtn.classList.toggle('active', compareMode);
  normalFilterBar.style.display = compareMode ? 'none' : '';
  cmpFilterBar.classList.toggle('visible', compareMode);
  renderAll();
  if(companiesLoaded) renderCompanyList();
});

// ============================================================
// COMPANY LIST
// ============================================================
let allCompanies = [];
let companiesLoaded = false;

// company list state
let cState = {
  search: '',
  sfFilter: 'all',   // all / sf / ws
  founder: false,     // å‰µæ¥­è€…ãƒ•ãƒ©ã‚°
  aov: new Set(),     // é¸æŠä¸­AOVãƒãƒ³ãƒ‰ï¼ˆç©º=å…¨ã¦ï¼‰
  salesMin: 0,
  salesMax: 999999999999,
  empMin: 0,
  empMax: 9999999,
  scoreMin: 0,
  sort: 'sales_desc',
  page: 1,
  perPage: 50,
};

// AOV Band ã®å®šç¾©é †
const AOV_BANDS = ['$1-10k','$10k-50k','$50k-100k','$100k-200k','$200k-600k','$600k-1M','$1M-5M','$5M+'];

const PAGE_RANGE = 5;

function getCompanyFiltered() {
  let data = allCompanies;

  // region/pref filter (sync with main state or compare A)
  const activeState = compareMode ? stateA : state;
  if(activeState.region !== 'ALL'){
    const prefs = REGIONS[activeState.region] || [];
    data = data.filter(c => prefs.includes(c.pref));
  }
  if(activeState.pref !== 'ALL') data = data.filter(c => c.pref === activeState.pref);

  // sf filter
  if(cState.sfFilter === 'sf') data = data.filter(c => c.sf === '1');
  else if(cState.sfFilter === 'ws') data = data.filter(c => c.sf !== '1');

  // å‰µæ¥­è€…ãƒ•ãƒ©ã‚°ï¼ˆä¸Šéƒ¨ or ä¸‹éƒ¨ã©ã¡ã‚‰ã‹ãŒONãªã‚‰é©ç”¨ï¼‰
  if(cState.founder || state.founder) data = data.filter(c => c.founder === '1');

  // AOV Bandï¼ˆä¸Šéƒ¨ãƒ»ä¸‹éƒ¨ã®é¸æŠã‚’ãƒãƒ¼ã‚¸ï¼šé¸æŠãŒã‚ã‚‹æ–¹ã‚’ä½¿ã†ã€ä¸¡æ–¹ã‚ã‚Œã°ORï¼‰
  const mergedAov = new Set([...cState.aov, ...state.aov]);
  if(mergedAov.size > 0) data = data.filter(c => mergedAov.has(c.aov));

  // å£²ä¸Šé«˜ãƒ¬ãƒ³ã‚¸ï¼ˆåƒå††å˜ä½ã§ä¿æŒï¼‰
  if(cState.salesMin > 0)          data = data.filter(c => (c.sales_num||0) >= cState.salesMin);
  if(cState.salesMax < 999999999999) data = data.filter(c => (c.sales_num||0) <  cState.salesMax);

  // å¾“æ¥­å“¡æ•°ãƒ¬ãƒ³ã‚¸
  if(cState.empMin > 0)           data = data.filter(c => (c.employees_num||0) >= cState.empMin);
  if(cState.empMax < 9999999)     data = data.filter(c => (c.employees_num||0) <= cState.empMax);

  // è©•ç‚¹ä¸‹é™
  if(cState.scoreMin > 0) data = data.filter(c => (c.score_num||0) >= cState.scoreMin);

  // search
  if(cState.search) {
    const q = cState.search.toLowerCase();
    data = data.filter(c => (c.name||'').toLowerCase().includes(q) || (c.industry||'').toLowerCase().includes(q) || (c.pref||'').includes(q));
  }

  // sort
  data = [...data].sort((a,b)=>{
    if(cState.sort==='sales_desc') return (b.sales_num||0)-(a.sales_num||0);
    if(cState.sort==='sales_asc')  return (a.sales_num||0)-(b.sales_num||0);
    if(cState.sort==='emp_desc')   return (b.employees_num||0)-(a.employees_num||0);
    if(cState.sort==='score_desc') return (b.score_num||0)-(a.score_num||0);
    if(cState.sort==='rate_desc')  return (b.sf==='1'?1:0)-(a.sf==='1'?1:0);
    return 0;
  });

  return data;
}

function formatSales(val) {
  // sales_num ã®å˜ä½ã¯åƒå††
  if(!val) return 'â€”';
  const n = Number(val);
  if(isNaN(n)||n===0) return 'â€”';
  if(n >= 1000000000) return (n/1000000000).toFixed(1) + 'å…†å††';  // â‰¥1å…†å††
  if(n >= 100000)     return (n/100000).toFixed(0) + 'å„„å††';       // â‰¥1å„„å††
  if(n >= 100)        return (n/100).toFixed(1) + 'åƒä¸‡å††';        // â‰¥1åƒä¸‡å††
  return (n*1000).toLocaleString() + 'å††';
}

function getProdTags(c) {
  const map = [
    ['p_sales','Sales','#0176d3'],['p_service','Service','#2ecc71'],['p_slack','Slack','#7c5cbf'],
    ['p_ai','AI&Data','#ff6b35'],['p_analytics','Analytics','#f1c40f'],['p_integration','Integ.','#e74c3c']
  ];
  return map.filter(([k])=>c[k]==='1').map(([,label,color])=>`<span class="prod-tag" style="background:${color}22;color:${color};border:1px solid ${color}44">${label}</span>`).join('');
}

function renderCompanyList() {
  const filtered = getCompanyFiltered();
  const total = filtered.length;
  const totalPages = Math.max(1, Math.ceil(total / cState.perPage));
  if(cState.page > totalPages) cState.page = totalPages;
  const start = (cState.page-1)*cState.perPage;
  const page = filtered.slice(start, start+cState.perPage);

  document.getElementById('companyCount').textContent = `${total.toLocaleString()}ç¤¾ / å…¨${allCompanies.length.toLocaleString()}ç¤¾`;

  const wrap = document.getElementById('companyTableWrap');

  if(page.length === 0){
    wrap.innerHTML = `<div class="loading-msg" style="padding:30px">è©²å½“ã™ã‚‹ä¼æ¥­ãŒã‚ã‚Šã¾ã›ã‚“</div>`;
    document.getElementById('companyPagination').innerHTML='';
    return;
  }

  let html = `<table class="company-table">
    <thead><tr>
      <th>ä¼šç¤¾å</th>
      <th>éƒ½é“åºœçœŒ</th>
      <th>æ¥­ç¨®</th>
      <th>å£²ä¸Šé«˜</th>
      <th>å¾“æ¥­å“¡æ•°</th>
      <th>è©•ç‚¹</th>
      <th>SF</th>
      <th>å‰µæ¥­è€…</th>
      <th>å°å…¥ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆ</th>
      <th>AOV Band</th>
    </tr></thead><tbody>`;

  page.forEach(c=>{
    const scoreW = c.score_num ? Math.round(c.score_num/100*60) : 0;
    const sfBadge = c.sf==='1'
      ? `<span class="sf-badge yes">å°å…¥æ¸ˆ</span>`
      : `<span class="sf-badge no">WS</span>`;
    html += `<tr>
      <td><div class="company-name" title="${c.name||''}">${c.name||'â€”'}</div></td>
      <td><span class="company-pref">${c.pref||'â€”'}</span></td>
      <td><div class="company-industry" title="${c.industry||''}">${c.industry||'â€”'}</div></td>
      <td style="white-space:nowrap;font-size:11px">${formatSales(c.sales)}</td>
      <td style="font-size:12px">${c.employees_num ? Number(c.employees_num).toLocaleString()+'å' : 'â€”'}</td>
      <td>
        <div class="score-bar-wrap">
          <div class="score-bar" style="width:${scoreW}px;background:${c.score_num>60?'#2ecc71':c.score_num>40?'#f1c40f':'#e74c3c'}"></div>
          <span style="font-size:11px;font-weight:700">${c.score||'â€”'}</span>
        </div>
      </td>
      <td>${sfBadge}</td>
      <td style="text-align:center">${c.founder==='1' ? '<span style="color:#f1c40f;font-size:13px" title="å‰µæ¥­è€…ãƒ•ãƒ©ã‚°">ğŸŒ±</span>' : '<span style="color:var(--border)">â€”</span>'}</td>
      <td><div class="products-cell">${getProdTags(c)}</div></td>
      <td style="font-size:11px;color:var(--muted)">${c.aov||'â€”'}</td>
    </tr>`;
  });
  html += `</tbody></table>`;
  wrap.innerHTML = html;

  // pagination
  const pag = document.getElementById('companyPagination');
  pag.innerHTML = '';

  const prevBtn = document.createElement('button');
  prevBtn.className='page-btn'; prevBtn.textContent='â†'; prevBtn.disabled=cState.page<=1;
  prevBtn.addEventListener('click',()=>{if(cState.page>1){cState.page--;renderCompanyList();document.querySelector('.company-section').scrollIntoView({behavior:'smooth'});}});
  pag.appendChild(prevBtn);

  const startPage = Math.max(1, cState.page - Math.floor(PAGE_RANGE/2));
  const endPage   = Math.min(totalPages, startPage + PAGE_RANGE - 1);
  if(startPage>1){ const b=document.createElement('button');b.className='page-btn';b.textContent='1';b.addEventListener('click',()=>{cState.page=1;renderCompanyList();});pag.appendChild(b); if(startPage>2){const e=document.createElement('span');e.className='page-info';e.textContent='...';pag.appendChild(e);} }
  for(let i=startPage;i<=endPage;i++){
    const b=document.createElement('button'); b.className='page-btn'+(i===cState.page?' active':''); b.textContent=i;
    b.addEventListener('click',()=>{cState.page=i;renderCompanyList();document.querySelector('.company-section').scrollIntoView({behavior:'smooth'});});
    pag.appendChild(b);
  }
  if(endPage<totalPages){ if(endPage<totalPages-1){const e=document.createElement('span');e.className='page-info';e.textContent='...';pag.appendChild(e);} const b=document.createElement('button');b.className='page-btn';b.textContent=totalPages;b.addEventListener('click',()=>{cState.page=totalPages;renderCompanyList();});pag.appendChild(b); }

  const nextBtn=document.createElement('button');
  nextBtn.className='page-btn'; nextBtn.textContent='â†’'; nextBtn.disabled=cState.page>=totalPages;
  nextBtn.addEventListener('click',()=>{if(cState.page<totalPages){cState.page++;renderCompanyList();document.querySelector('.company-section').scrollIntoView({behavior:'smooth'});}});
  pag.appendChild(nextBtn);

  const info=document.createElement('span');
  info.className='page-info'; info.textContent=`${start+1}â€“${Math.min(start+cState.perPage,total)} / ${total.toLocaleString()}ç¤¾`;
  pag.appendChild(info);
}

// ============================================================
// GLOBAL FILTER BAR: AOV & å‰µæ¥­è€…ãƒãƒƒãƒ—
// ============================================================

// ã‚°ãƒ­ãƒ¼ãƒãƒ«AOVãƒãƒƒãƒ—ï¼ˆä¸Šéƒ¨ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒãƒ¼ï¼‰
const globalAovContainer = document.getElementById('globalAovChips');
AOV_BANDS.forEach(band=>{
  const chip = document.createElement('button');
  chip.className = 'chip';
  chip.textContent = band;
  chip.dataset.aov = band;
  chip.addEventListener('click',()=>{
    if(state.aov.has(band)){
      state.aov.delete(band);
      chip.classList.remove('active');
      chip.style.background=''; chip.style.borderColor=''; chip.style.color='';
    } else {
      state.aov.add(band);
      chip.classList.add('active');
      chip.style.background='rgba(124,92,191,0.8)';chip.style.borderColor='transparent';chip.style.color='#fff';
    }
    // ä¼æ¥­ä¸€è¦§å´ã‚‚åŒæœŸ
    cState.aov = new Set(state.aov);
    document.querySelectorAll('#aovChips .aov-chip').forEach(c=>{
      const active = cState.aov.has(c.dataset.aov);
      c.classList.toggle('active', active);
    });
    cState.page=1; renderAll();
  });
  globalAovContainer.appendChild(chip);
});

// ã‚°ãƒ­ãƒ¼ãƒãƒ«å‰µæ¥­è€…ãƒãƒƒãƒ—ï¼ˆä¸Šéƒ¨ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒãƒ¼ï¼‰
const globalFounderChip = document.getElementById('globalFounderChip');
globalFounderChip.addEventListener('click',()=>{
  state.founder = !state.founder;
  if(state.founder){
    globalFounderChip.classList.add('active');
    globalFounderChip.style.background='rgba(241,196,15,0.25)';
    globalFounderChip.style.borderColor='#f1c40f';
    globalFounderChip.style.color='#f1c40f';
  } else {
    globalFounderChip.classList.remove('active');
    globalFounderChip.style.background='';
    globalFounderChip.style.borderColor='';
    globalFounderChip.style.color='';
  }
  // ä¼æ¥­ä¸€è¦§å´ã‚‚åŒæœŸ
  cState.founder = state.founder;
  const ft = document.getElementById('founderToggle');
  if(ft) ft.classList.toggle('active', cState.founder);
  cState.page=1; renderAll();
});

// ============================================================
// COMPANY FILTER UI SETUP
// ============================================================

// AOV chipsï¼ˆcompanies.jsonèª­ã¿è¾¼ã¿å¾Œã«å‹•çš„ç”Ÿæˆ â†’ ã“ã“ã¯å…ˆã«ã‚³ãƒ³ãƒ†ãƒŠè¨­å®šã®ã¿ï¼‰
function buildAovChips() {
  const container = document.getElementById('aovChips');
  container.innerHTML = '';
  AOV_BANDS.forEach(band=>{
    const btn = document.createElement('button');
    btn.className = 'aov-chip';
    btn.textContent = band;
    btn.dataset.aov = band;
    btn.addEventListener('click',()=>{
      if(cState.aov.has(band)){
        cState.aov.delete(band);
        btn.classList.remove('active');
      } else {
        cState.aov.add(band);
        btn.classList.add('active');
      }
      cState.page=1; renderCompanyList();
    });
    container.appendChild(btn);
  });
}
buildAovChips();

// toolbar events
let searchTimer;
document.getElementById('companySearch').addEventListener('input', e=>{
  clearTimeout(searchTimer);
  searchTimer = setTimeout(()=>{cState.search=e.target.value; cState.page=1; if(companiesLoaded)renderCompanyList();}, 250);
});

document.querySelectorAll('.seg-btn').forEach(btn=>{
  btn.addEventListener('click',()=>{
    document.querySelectorAll('.seg-btn').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    cState.sfFilter=btn.dataset.sf; cState.page=1; if(companiesLoaded)renderCompanyList();
  });
});

// å‰µæ¥­è€…ãƒ•ãƒ©ã‚°
const founderToggle = document.getElementById('founderToggle');
founderToggle.addEventListener('click',()=>{
  cState.founder = !cState.founder;
  founderToggle.classList.toggle('active', cState.founder);
  cState.page=1; if(companiesLoaded)renderCompanyList();
});

// å£²ä¸Šé«˜
document.getElementById('salesMinSel').addEventListener('change',e=>{
  cState.salesMin=Number(e.target.value); cState.page=1; if(companiesLoaded)renderCompanyList();
});
document.getElementById('salesMaxSel').addEventListener('change',e=>{
  cState.salesMax=Number(e.target.value); cState.page=1; if(companiesLoaded)renderCompanyList();
});

// å¾“æ¥­å“¡æ•°
document.getElementById('empMinSel').addEventListener('change',e=>{
  cState.empMin=Number(e.target.value); cState.page=1; if(companiesLoaded)renderCompanyList();
});
document.getElementById('empMaxSel').addEventListener('change',e=>{
  cState.empMax=Number(e.target.value); cState.page=1; if(companiesLoaded)renderCompanyList();
});

// è©•ç‚¹
document.getElementById('scoreMinSel').addEventListener('change',e=>{
  cState.scoreMin=Number(e.target.value); cState.page=1; if(companiesLoaded)renderCompanyList();
});

// ã‚½ãƒ¼ãƒˆ
document.getElementById('companySortSel').addEventListener('change',e=>{
  cState.sort=e.target.value; cState.page=1; if(companiesLoaded)renderCompanyList();
});

// ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒªã‚»ãƒƒãƒˆ
document.getElementById('companyFilterClear').addEventListener('click',()=>{
  cState.search=''; cState.sfFilter='all'; cState.founder=false;
  cState.aov=new Set(); cState.salesMin=0; cState.salesMax=999999999999;
  cState.empMin=0; cState.empMax=9999999; cState.scoreMin=0; cState.page=1;
  // UIãƒªã‚»ãƒƒãƒˆ
  document.getElementById('companySearch').value='';
  document.querySelectorAll('.seg-btn').forEach((b,i)=>b.classList.toggle('active',i===0));
  founderToggle.classList.remove('active');
  document.querySelectorAll('.aov-chip').forEach(c=>c.classList.remove('active'));
  document.getElementById('salesMinSel').value='0';
  document.getElementById('salesMaxSel').value='999999999999';
  document.getElementById('empMinSel').value='0';
  document.getElementById('empMaxSel').value='9999999';
  document.getElementById('scoreMinSel').value='0';
  if(companiesLoaded)renderCompanyList();
});

// ============================================================
// LOAD companies.json
// ============================================================
fetch('companies.json')
  .then(r=>{ if(!r.ok) throw new Error('companies.json not found'); return r.json(); })
  .then(data=>{
    allCompanies = data;
    companiesLoaded = true;
    document.getElementById('companyHint').textContent = `${data.length.toLocaleString()}ç¤¾`;
    renderCompanyList();
  })
  .catch(err=>{
    document.getElementById('companyTableWrap').innerHTML = `<div class="loading-msg">
      âš ï¸ companies.json ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ<br>
      <span style="font-size:11px;color:var(--muted)">åŒã˜ãƒ•ã‚©ãƒ«ãƒ€ã«companies.jsonãŒå¿…è¦ã§ã™ã€‚${err.message}</span>
    </div>`;
    document.getElementById('companyCount').textContent = 'èª­ã¿è¾¼ã¿å¤±æ•—';
  });

// ============================================================
// INIT
// ============================================================
renderAll();
</script>
</body>
</html>
